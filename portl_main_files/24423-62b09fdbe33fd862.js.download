try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="66d99630-2aca-49e4-8f0e-402a816f79aa",e._sentryDebugIdIdentifier="sentry-dbid-66d99630-2aca-49e4-8f0e-402a816f79aa")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:anthropic-apps":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[24423],{0x5ae340a6:(e,t,a)=>{a.d(t,{wD:()=>T,z7:()=>E});var s=a(0x22102fd88),n=a(0x64121218),l=a.n(n),r=a(0x12c9046cd),i=a(0x14de19ae8),o=a(0x8f813b9c),d=a(0x31075f4f),u=a(0xac309a83),c=a(0x17f3a2521),f=a(0xa6a34c14),g=a(0x213bd1299),m=a(0x1a1f6dda6),h=a(0x18c2bb2d),p=a(0x160045b25),x=a(0xfc89b4a4),v=a(0x1ab0d1ca1),y=a(0x38e6572),b=a(0x156c4e43b),M=a(0x225bae024),_=a(0x183548b63),j=a(0x22fc8d729),w=a(0x209ad4cb7),S=a(0x1d1a079e9),C=a(0x17ced59d0),k=a(0x17b66474f),N=a(0x2174968e5),U=a(0x14a42df1b);function B(e){let{onCancel:t,onConfirm:a}=e,n=(0,v.A)(),l=(0,x.useRef)(null),{menuOptions:r,getEnabledRemoteTools:i,allToolKeys:o,anyConnectorEnabled:d,toggleAllConnectors:u}=(0,N.$3)(),c=(0,U.Cn)({setMcpDirectoryModalIsOpen:I,setStyleModalOpenWithScreen:I,setCreateProjectModalIsOpen:I,setGithubModalIsOpen:I,setGmailAuthModalIsOpen:I,setCreatePromptArgumentModalIsOpen:I}),f=(0,k._9)({actions:c,inputMenuIsOpen:!0,setInputMenuIsOpen:()=>void 0,rootItems:r,menuType:"research"});return(0,x.useEffect)(()=>{setTimeout(()=>{l.current&&l.current.focus()})},[]),(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(_.aF,{isOpen:!0,modalSize:"2lg",onClose:t,children:(0,s.jsxs)("div",{className:"flex flex-col gap-4 p-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:(0,s.jsx)(y.A,{defaultMessage:"Enable connectors for Claude to use in research",id:"bnGGwdCceV"})}),o.length>0&&(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)("button",{type:"button",className:"text-sm text-accent-secondary-100 hover:underline",onClick:()=>u(!d),children:d?n.formatMessage({defaultMessage:"Disable all tools",id:"8A9N39nihk"}):n.formatMessage({defaultMessage:"Enable all tools",id:"x4/g36jIjW"})})}),(0,s.jsx)("div",{className:"border border-border-300 rounded-lg",children:(0,s.jsxs)("div",{className:"p-2",children:[f.path&&(0,s.jsx)(C.s,{path:f.path,inputMenuSearchQuery:f.inputMenuSearchQuery,setInputMenuSearchQuery:f.setInputMenuSearchQuery,handleBack:f.handleBack}),(0,s.jsx)("div",{className:"space-y-1",children:f.menuView.currentItems.filter(e=>{let{menuItemHidden:t}=e;return!t}).map(e=>(0,s.jsx)(S.$,{item:e,onClick:()=>f.handleClickItem(e),isHighlighted:f.highlightedItemKey===e.key},e.key))})]})}),(0,s.jsx)("div",{className:"bg-bg-300 border-border-400 border px-4 py-3 rounded-lg text-sm text-text-300",children:(0,s.jsx)(y.A,{defaultMessage:"Ensure you have appropriate permissions and trust third-party tools before continuing. <link>Learn more</link> about safely using research with connected apps.",id:"VU67M+9esK",values:{link:e=>(0,s.jsx)(j.Y,{href:"https://support.anthropic.com/",target:"_blank",rel:"noreferrer noopener",children:e})}})}),(0,s.jsxs)("div",{className:"flex flex-row justify-end gap-2",children:[(0,s.jsx)(M.$,{variant:"secondary",onClick:t,children:(0,s.jsx)(y.A,{defaultMessage:"Cancel Research",id:"GuxgLirKvY"})}),(0,s.jsxs)(M.$,{ref:l,onClick:function(){a({tools:i()})},children:[(0,s.jsx)(y.A,{defaultMessage:"Confirm",id:"N2IrpMDHDB"}),(0,s.jsx)("span",{className:"inline-block ml-2 p-1 bg-bg-000/20 rounded-sm",children:(0,s.jsx)(w.y,{size:12})})]})]})]})})})}function I(){}var A=a(0xec9172c1),z=a(0x16801a2b9),O=a(0x19a5dec78);let E=b.vk(e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){}return e},b.Ik({task_id:b.Yj()}));function T(e){let{toolUseId:t,isFirstBlockOfMessage:a=!1,isLastBlockOfMessage:n=!1,conversationUuid:l,toolResult:o,isShared:d,isExpanded:f=!1,isStreaming:g=!1,context:h}=e,p=(0,u.fS)("papi_mcp"),{activeOrganization:y}=(0,i.YL)(),{dispatchChatResource:b}=(0,z.i)(),{setIsDrawerExpanded:M}=(0,A.x)(),{decisionState:_,approveTool:j,denyTool:w}=function(e,t,a,s){let[n,l]=(0,x.useState)("pending"),i=!!(e&&t&&s),{isPending:o}=(0,r.Sk)("/api/organizations/".concat(e,"/chat_conversations/").concat(t,"/tool_approval_state/").concat(a),{enabled:i}),d=(0,r.L2)("/api/organizations/".concat(e,"/chat_conversations/").concat(t,"/tool_approval"),"POST",{enabled:!!(t&&!o),onSuccess(e,t){l(t.is_approved?"approved":"denied")}}).mutate;return{decisionState:n,isStatePending:o,approveTool:(0,x.useCallback)(e=>{let{tools:t}=e;d({tool_use_id:a,is_approved:!0,params:{tools:t}})},[d,a]),denyTool:(0,x.useCallback)(()=>{d({tool_use_id:a,is_approved:!1,params:{disapproval_reason:"user_canceled"}})},[d,a])}}(null==y?void 0:y.uuid,l,t,g),S=g?"approved"===_:o&&!(null==o?void 0:o.is_error),C=p&&(null==h?void 0:h.tools.length)&&g&&"pending"===_,k=(0,x.useMemo)(()=>{if(!(null==o?void 0:o.content))return;let e=o.content.map(e=>e&&"text"in e?e.text:"").join("\n"),{data:t}=E.safeParse(e);return null==t?void 0:t.task_id},[null==o?void 0:o.content]),{compassStatus:N,isLoading:U,error:I}=(0,O.CH)({organizationUuid:null==y?void 0:y.uuid,conversationUuid:l,taskId:k,isShared:d,enabled:S});(0,O.IK)(l,null==N?void 0:N.status);let T=!N,P=(0,x.useCallback)(()=>{T||(M(!0),b({type:"OPEN_COMPASS_STATUS",data:{conversationUuid:l,organizationUuid:null==y?void 0:y.uuid,isShared:d,toolUseId:null==o?void 0:o.tool_use_id,taskId:k}}))},[T,b,l,null==y?void 0:y.uuid,M,d,o,k]),G=(null==N?void 0:N.status)||c.zu.Starting,D=!!I||!!(null==o?void 0:o.is_error),L=(0,v.A)(),{title:Q,subtitle:Y}=(0,x.useMemo)(()=>{let e,t;if(D){var a,s;return(null==o?void 0:o.is_error)&&((null==o?void 0:o.message)==="user_canceled"||(null==o||null==(a=o.content)?void 0:a.some(e=>(null==e?void 0:e.type)==="text"&&(null==e?void 0:e.text)==="Denied.")))?{title:L.formatMessage({defaultMessage:"Stopped",id:"1LBny5MvRa"}),subtitle:L.formatMessage({defaultMessage:"At your request",id:"2n0LtR1+bC"})}:(null==o?void 0:o.is_error)&&((null==o?void 0:o.message)==="approval_timeout"||(null==o||null==(s=o.content)?void 0:s.some(e=>(null==e?void 0:e.type)==="text"&&(null==e?void 0:e.text)==="No approval received.")))?{title:L.formatMessage({defaultMessage:"Stopped",id:"1LBny5MvRa"}),subtitle:L.formatMessage({defaultMessage:"No response on which connectors to enable during research",id:"HZp4wEGqGR"})}:{title:L.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"})}}let n=(null==N?void 0:N.total_sources)||0,l=0===n?L.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"}):L.formatMessage({defaultMessage:"{count, plural, one {# source} other {# sources}} and counting...",id:"wfqjY4cYXF"},{count:n}),r=L.formatMessage({defaultMessage:"{count, plural, one {# source} other {# sources}}",id:"WrpI57Uej/"},{count:n}),i=(0,O.Ui)(N),d=i||L.formatMessage({defaultMessage:"Researching...",id:"eD084+/kcH"}),u=i||L.formatMessage({defaultMessage:"Research complete",id:"9Tbl1w5GjC"});switch(G){case c.zu.Starting:{let t=[L.formatMessage({defaultMessage:"Getting everything ready...",id:"5nJVpwt8gP"}),L.formatMessage({defaultMessage:"Preparing your research assistant...",id:"vxRKHhLIWM"}),L.formatMessage({defaultMessage:"Initializing research tools...",id:"Lm6wYLrJ1Q"}),L.formatMessage({defaultMessage:"Setting up my research space...",id:"EGN8CB7IRt"}),L.formatMessage({defaultMessage:"Configuring research parameters...",id:"eYoO3vRQgY"}),L.formatMessage({defaultMessage:"Loading research capabilities...",id:"GHM/w3WPnr"}),L.formatMessage({defaultMessage:"Preparing to dive in...",id:"EW22N+F8aq"}),L.formatMessage({defaultMessage:"Setting the stage for discovery...",id:"l8a+mVgI7N"}),L.formatMessage({defaultMessage:"Getting your assistant ready...",id:"GLpbkAPwDC"}),L.formatMessage({defaultMessage:"Activating research mode...",id:"SPBnT2clve"}),L.formatMessage({defaultMessage:"Warming up the engines...",id:"biUnCTBtnQ"})],a=Math.floor(Math.random()*t.length);e=t[a];break}case c.zu.Planning:e=d,t=L.formatMessage({defaultMessage:"Creating my research plan...",id:"4eRg5buC9J"});break;case c.zu.InitiatingAgents:e=d,t=L.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"});break;case c.zu.Searching:e=d,t=l;break;case c.zu.CreatingArtifact:e=d,t=L.formatMessage({defaultMessage:"Writing and citing report...",id:"2b/CKxnAiJ"});break;case c.zu.Completed:t=r,e=u;break;case c.zu.Cancelled:e=d,t=L.formatMessage({defaultMessage:"Interrupted",id:"rJQDmlVOoX"});break;case c.zu.TimedOut:case c.zu.Failed:e=L.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"})}return{title:e,subtitle:t}},[L,G,N,D,null==o?void 0:o.is_error,null==o?void 0:o.message,null==o?void 0:o.content]);return C?(0,s.jsx)(B,{onCancel:w,onConfirm:e=>{let{tools:t}=e;j({tools:t})}}):(0,s.jsx)("div",{className:(0,m.A)("my-3",a?"mt-2":"mt-3",n?"mb-2":"mb-3"),children:U?(0,s.jsxs)("div",{className:"w-full p-4 text-text-000 font-ui rounded-xl border border-border-300 shadow-xs",children:[(0,s.jsx)("div",{className:"h-5 bg-bg-300/30 rounded-md w-3/4"}),(0,s.jsx)("div",{className:"flex text-text-300 text-xs items-center mt-2",children:(0,s.jsx)("div",{className:"h-5 bg-bg-300/30 rounded-md w-24"})})]}):(0,s.jsxs)("button",{className:(0,m.A)("transition-[border] duration-300 w-full p-4 !pt-0 text-text-000 font-ui rounded-xl border shadow-xs overflow-hidden",!T&&"cursor-pointer hover:shadow-sm hover:bg-bg-000/50 hover:border-border-200",f?"!border-accent-secondary-200":"border-border-300"),disabled:T,onClick:P,children:[(0,s.jsx)(R,{title:Q,compassStatus:N,useShimmer:G===c.zu.Starting,isError:D||G===c.zu.Failed||G===c.zu.TimedOut,isExpanded:f}),(0,s.jsx)(F,{subtitle:Y,compassStatus:N,isError:G===c.zu.Cancelled,useShimmer:!f&&!!N&&![c.zu.CreatingArtifact,c.zu.Completed,c.zu.Cancelled,c.zu.TimedOut,c.zu.Failed].includes(N.status)})]})})}function P(e){let{className:t,text:a,useShimmer:n}=e,[r,i]=(0,x.useState)(a),[d,u]=(0,x.useState)(!1),[c,f]=(0,x.useState)("");return(0,x.useEffect)(()=>{if(a!==r){f(r),i(a),u(!0);let e=setTimeout(()=>{u(!1)},300);return()=>clearTimeout(e)}},[a,r]),(0,s.jsxs)("div",{title:r,className:"jsx-34e91f3cef6c43c9 "+((0,m.A)("relative overflow-hidden",t)||""),children:[(0,s.jsx)(l(),{id:"34e91f3cef6c43c9",children:"@keyframes slideUpFadeOut{0%{transform:translatey(0);opacity:1}100%{transform:translatey(-100%);opacity:0}}@keyframes slideUpFadeIn{0%{transform:translatey(100%);opacity:0}100%{transform:translatey(0);opacity:1}}"}),d&&(0,s.jsx)("div",{style:{animation:"slideUpFadeOut 300ms forwards"},className:"jsx-34e91f3cef6c43c9 absolute w-full text-ellipsis overflow-hidden whitespace-nowrap text-left",children:n?(0,s.jsx)(o.N,{children:c}):c}),(0,s.jsx)("div",{style:d?{animation:"slideUpFadeIn 300ms forwards"}:void 0,className:"jsx-34e91f3cef6c43c9 w-full relative text-ellipsis overflow-hidden whitespace-nowrap text-left",children:n?(0,s.jsx)(o.N,{children:r}):r})]})}function R(e){let{title:t,isError:a,compassStatus:n,useShimmer:l,isExpanded:r}=e,[i,o]=(0,x.useState)(!1),u=(0,O.Nw)(n),c=(0,x.useRef)(u);(0,x.useEffect)(()=>{u&&!c.current&&(o(!0),setTimeout(()=>{o(!1)},3.5*u.length+.5),c.current=u)},[u]);let v=!r&&i;return(0,s.jsxs)("div",{className:"flex flex-row justify-between items-center h-9 gap-4 relative",children:[(0,s.jsxs)("div",{className:"h-9 min-w-0 w-full",children:[v&&!!u&&(0,s.jsx)(h.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:(0,s.jsx)(G,{thought:u})}),(0,s.jsx)(p.N,{initial:!1,children:!(v&&u)&&(0,s.jsxs)(h.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5,ease:d.A.inOutQuart},className:(0,m.A)("absolute w-[calc(100%-1.75rem)] top-0 left-0 flex items-center rounded-lg text-sm min-w-0 mt-4",a?"text-danger-000":""),children:[a&&(0,s.jsx)(f.N,{className:"text-danger-000 mr-1 flex-shrink-0",size:16}),(0,s.jsx)("div",{className:"flex-1 overflow-hidden text-left text-ellipsis break-words text-nowrap",children:(0,s.jsx)(P,{text:t,useShimmer:!!l&&!a})})]})})]}),!!n&&(0,s.jsx)(g.K,{size:12,className:"text-text-500 mt-4"})]})}function F(e){var t,a;let{subtitle:n,isError:l,compassStatus:r,useShimmer:i}=e,o=(0,x.useMemo)(()=>(null==r?void 0:r.agents)&&!(r.agents.length<1)?(0,O.mk)({agents:r.agents,n:3}):[],[null==r?void 0:r.agents]);return n?(0,s.jsxs)("div",{className:"flex text-text-300 text-xs items-center mt-2 tabular-nums h-5",children:[!!o.length&&(0,s.jsx)("div",{className:"flex-shrink-0 mr-1",children:(0,s.jsx)(O.mq,{hrefs:o})}),(null==r?void 0:r.status)===c.zu.Completed&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.A,{defaultMessage:"Research complete",id:"9Tbl1w5GjC"}),(0,s.jsx)("span",{className:"text-[0.4rem] mx-1 text-[#A29F95]",children:"•"})]}),(0,s.jsx)(P,{text:n,useShimmer:i,className:l?"text-danger-000":""}),!!(null==r?void 0:r.started_at)&&r.status!==c.zu.Cancelled&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-[0.4rem] mx-1 text-[#A29F95]",children:"•"}),(0,s.jsx)("div",{className:"text-text-500",children:(0,s.jsx)(O.YE,{startedAt:null!=(t=null==r?void 0:r.started_at)?t:null,completedAt:null!=(a=null==r?void 0:r.finished_at)?a:null})})]})]}):null}function G(e){let{thought:t}=e;return(0,s.jsx)("div",{className:"h-9 w-full",children:(0,s.jsx)("div",{className:"blur-[2px] h-11 px-1 -mx-1 -mb-2 w-full relative overflow-y-hidden overflow-x-visible [mask-image:linear-gradient(to_top,_hsl(var(--always-black)/0%)_0%,hsl(var(--always-black)/100%)_75%,_hsl(var(--always-black)/0%)_100%)]",children:(0,s.jsx)(h.P.div,{className:"absolute top-0 left-1 right-0 text-left",initial:{y:40},animate:{y:"calc(-100%)"},transition:{delay:.5,duration:3.5*t.length/1e3,ease:d.A.inOutBase},children:(0,s.jsx)(O.GT,{thought:t})})})})}},0xe13d4dc9:(e,t,a)=>{a.d(t,{OC:()=>n,eb:()=>l,nb:()=>r});var s=a(0x5ae340a6);function n(e){var t;return!!r(e)&&!!(null==(t=e.content)?void 0:t.some(e=>"tool_result"===e.type&&"artifacts"===e.name))}function l(e){let t=r(e);if(!t)return;let a=t.content.map(e=>e&&"text"in e?e.text:"").join("\n"),{data:n}=s.z7.safeParse(a);return null==n?void 0:n.task_id}function r(e){var t;return null==(t=e.content)?void 0:t.find(e=>"tool_result"===e.type&&"launch_extended_search_task"===e.name)}},0x17e7bc007:(e,t,a)=>{a.d(t,{Ci:()=>Q,Gu:()=>F,HF:()=>k,JX:()=>j,P8:()=>B,Po:()=>x,Q3:()=>Y,QS:()=>U,RR:()=>L,ST:()=>N,SY:()=>v,U4:()=>E,_Q:()=>P,dd:()=>C,fy:()=>J,gq:()=>D,n5:()=>A,ot:()=>b,oz:()=>p,uO:()=>O,uQ:()=>G,w0:()=>I,xJ:()=>T,xw:()=>w,zg:()=>R});var s=a(0x628a9a0b),n=a(0x24fcf6beb),l=a(0x16ab3413b),r=a.n(l),i=a(0x394ef833),o=a(0x16784b660),d=a(0x107838ca5),u=a(0x2369694a1),c=a(0xe13d4dc9),f=a(0x1f22b8dda);let g={uuid:"",sender:"assistant",content:[],created_at:"",updated_at:"",attachments:[],files:[],files_v2:[],sync_sources:[],index:0,parent_message_uuid:void 0},m=e=>{let t={};return e.forEach(e=>{if("assistant"!==e.sender)return;let[a]=h(t,e);Object.keys(a).forEach(e=>{t[e]={...t[e],...a[e]}})}),t},h=(e,t)=>{let a=(0,n.Xz)(t),s=null,l={};return a.forEach(t=>{var a,r,i;let{id:o,currentVersion:d,type:u,title:c,language:f}=t,g=null==(i=((null==(a=l[o])?void 0:a.versions)||(null==(r=e[o])?void 0:r.versions)||[]).slice(-1)[0])?void 0:i.resultState,m=(0,n.zI)(d,g),h={...d,resultState:m};l[o]?l[o]={...l[o],versions:[...l[o].versions,h]}:e[o]?l[o]={...e[o],versions:[...e[o].versions,h]}:l[o]={id:o,type:u||"document",title:c||"Untitled",language:f||void 0,versions:[h]},s=o}),[l,s]},p=(0,i.v)()((0,o.eh)((e,t)=>({selectedMessageUuid:null,messageByUuid:{},pathUuidsByConversation:{},conversationSettings:null,artifacts:{},allFiles:[],allAttachments:[],allSyncSources:[],hasArtifacts:!1,fullText:"",lastStreamingArtifactId:null,streamingArtifacts:{},setSelectedMessage:t=>e({selectedMessageUuid:t}),setMessages:(t,a)=>{e(e=>{let n={},l=[];a.forEach(e=>{n[e.uuid]=e,l.push(e.uuid)});let r=m(a),i=a.flatMap(e=>e.files),o=a.flatMap(e=>e.attachments),d=a.flatMap(e=>e.sync_sources),u=Object.keys(r).length>0,c=a.map(e=>(0,s.Rs)(e)).join(" ");return{messageByUuid:n,pathUuidsByConversation:{...e.pathUuidsByConversation,[t]:l},artifacts:r,streamingArtifacts:{},allFiles:i,allAttachments:o,allSyncSources:d,hasArtifacts:u,fullText:c,lastStreamingArtifactId:null}})},appendMessages:(e,a)=>{let s=t(),n=[...(s.pathUuidsByConversation[e]||[]).map(e=>s.messageByUuid[e]).filter(Boolean),...a];s.setMessages(e,n)},updateMessage:(a,n)=>{let{messageByUuid:l}=t(),r={...l,[a]:n},i=Object.values(r),o=m(i),d=i.flatMap(e=>e.files),u=i.flatMap(e=>e.attachments),c=i.flatMap(e=>e.sync_sources),f=Object.keys(o).length>0;e({messageByUuid:r,artifacts:o,allFiles:d,allAttachments:u,allSyncSources:c,hasArtifacts:f,fullText:i.map(e=>(0,s.Rs)(e)).join(" "),lastStreamingArtifactId:null})},setArtifacts:t=>e({artifacts:t,hasArtifacts:Object.keys(t).length>0}),setConversationSettings:t=>e({conversationSettings:t}),setPathUuids:(t,a)=>e(e=>({pathUuidsByConversation:{...e.pathUuidsByConversation,[t]:a}})),updateStreamingMessage:(a,s,n)=>{let{messageByUuid:l,pathUuidsByConversation:r,artifacts:i}=t(),o=r[a]||[],d=o[o.length-1],u=l[d];if(!u)return;let c={...u,content:n},[f,g]=h(i,c);e({messageByUuid:{...l,[d]:c},lastStreamingArtifactId:g,streamingArtifacts:f})},getConversationMessages:e=>{let a=t();return(a.pathUuidsByConversation[e]||[]).map(e=>a.messageByUuid[e]).filter(Boolean)}}))),x=()=>p(e=>e.setArtifacts),v=()=>p(e=>e.lastStreamingArtifactId),y=[],b=e=>p((0,d.k)(t=>{let a=t.pathUuidsByConversation[e];return a&&0!==a.length?a.map(e=>t.messageByUuid[e]).filter(Boolean):y})),M=new Map,_=[],j=e=>p(t=>{let a=t.messageByUuid[e];return a||(M.has(e)||M.set(e,{...g,uuid:e}),M.get(e))}),w=e=>p(t=>t.pathUuidsByConversation[e]||_),S=e=>p((0,d.k)(e)),C=()=>S(e=>e.artifacts),k=()=>(0,u.n)(p,e=>({...e.artifacts,...e.streamingArtifacts}),r()),N=e=>(0,u.n)(p,t=>t.artifacts[e],r()),U=()=>S(e=>e.allFiles),B=()=>S(e=>e.allAttachments),I=()=>S(e=>e.allSyncSources),A=e=>p(t=>{let a=(t.pathUuidsByConversation[e]||[])[0];return a?t.messageByUuid[a]:void 0}),z=e=>p(t=>{let a=(t.pathUuidsByConversation[e]||[])[1];return a?t.messageByUuid[a]:void 0}),O=e=>{var t;let a=z(e);return(null==a||null==(t=a.content)?void 0:t.length)||0},E=e=>{let t=z(e);return null==t?void 0:t.sender},T=e=>p(t=>{let a=t.pathUuidsByConversation[e]||[],s=a[a.length-1];return s?t.messageByUuid[s]:g}),P=e=>p(t=>{let a=t.pathUuidsByConversation[e]||[];return a[a.length-1]||null}),R=e=>p(t=>(t.pathUuidsByConversation[e]||[]).map(e=>t.messageByUuid[e]).filter(Boolean).some(e=>(0,c.OC)(e))),F=()=>p(e=>e.setMessages),G=()=>p(e=>e.appendMessages),D=()=>p(e=>e.updateStreamingMessage),L=()=>p(e=>e.getConversationMessages),Q=(e,t)=>(0,u.n)(p,a=>{let s=a.pathUuidsByConversation[e]||[],n=s[s.length-1],l=n?a.messageByUuid[n]:void 0;if(l){if(t){var r;return{...l,content:(null==(r=l.content)?void 0:r.map(e=>{let t={type:e.type};return("tool_use"===e.type||"tool_result"===e.type)&&(t.name=e.name),t}))||[]}}return l}},(e,a)=>{var s,n,l,r;return e&&a&&t?e.uuid===a.uuid&&(null==(s=e.content)?void 0:s.length)===(null==(n=a.content)?void 0:n.length)&&e.attachments.length===a.attachments.length&&e.files.length===a.files.length&&(null==(l=e.files_v2)?void 0:l.length)===(null==(r=a.files_v2)?void 0:r.length):e===a}),Y=e=>p(t=>{let a=t.pathUuidsByConversation[e]||[];for(let e=a.length-1;e>=0;e--){let s=t.messageByUuid[a[e]];if(s&&"human"===s.sender)return s}}),q=new Set(["bash","bash_tool","create_file","str_replace"]),H=new Set(["Bash","Edit","MultiEdit","Write","BashOutput"]),J=e=>{let t=(0,f.Zx)(e)?H:q;return p(a=>{let s=a.pathUuidsByConversation[e]||[];for(let e=s.length-1;e>=0;e--){let n=a.messageByUuid[s[e]];if(!n)continue;let l=n.content;if(l)for(let e=l.length-1;e>=0;e--){let a=l[e];if("tool_result"===a.type&&t.has(a.name))return[a.name,n.uuid,e].join("-")}}})}},0x19a5dec78:(e,t,a)=>{a.d(t,{CH:()=>b,GT:()=>k,IK:()=>y,Nw:()=>w,OQ:()=>_,Ui:()=>M,YE:()=>C,mk:()=>v,mq:()=>x});var s=a(0x22102fd88),n=a(0x628a9a0b),l=a(0x1fec22234),r=a(0xbca8e388),i=a(0x12c9046cd),o=a(0x17f3a2521),d=a(0x78b33fbd),u=a(0x1a1f6dda6),c=a(0x18c2bb2d),f=a(0xc6536c20),g=a(0xfc89b4a4),m=a(0x1ab0d1ca1),h=a(0x156c4e43b),p=a(0x1c12b3087);function x(e){let{hrefs:t}=e,a=t.map((e,t)=>(0,s.jsx)(c.P.div,{className:(0,u.A)("shadow-xs h-5 w-5 rounded-full overflow-hidden border-0.5 border-border-300 bg-bg-100 flex items-stretch justify-stretch","z-".concat(t+1)),initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.1+.05*t,duration:.3},children:(0,s.jsx)(l.d,{url:e,shouldFillBackground:!0,size:14})},t));return(0,s.jsx)("div",{className:"flex items-center -space-x-2",children:a})}function v(e){let{agents:t,n:a=5}=e,s=new Set;for(let e of t)for(let t of e.annotated_snippets)for(let e of t.tool_calls){var n;if("web_search"===e.tool_name&&(null==(n=e.output)?void 0:n.type)==="rich_content"&&e.output.content.length){for(let t of e.output.content.map(e=>{let{url:t}=e;return t}).filter(Boolean))if("string"==typeof t)try{let e=new URL(t);if(s.add(e.origin),s.size>=a)return Array.from(s).slice(0,a)}catch(e){}}}return Array.from(s)}function y(e,t){let a=!t||t===o.zu.Completed,s=(0,g.useRef)(a),{mutate:l}=(0,n.HF)(e,{refetchOnSettled:!0});(0,g.useEffect)(()=>{a&&!s.current&&l({settings:{compass_mode:null}}),s.current=a},[l,a,e])}function b(e){var t,a;let{organizationUuid:s,conversationUuid:l,taskId:r,isShared:u,enabled:c}=e,[m,h]=(0,g.useState)(!0),[,x]=(0,g.useState)(0),v=(0,d.useDynamicConfig)("use_confused_carousel_sounds").get("polling",[{intervalSeconds:30}]),y=null!=(a=null==(t=v[0])?void 0:t.intervalSeconds)?a:30,[b,M]=(0,g.useState)(y),_=(0,n._W)(l),j=(0,p.Tc)(e=>e.setCurrentCompassTask,"useCompassStatus"),w=u?"/api/organizations/".concat(s,"/chat_snapshots/").concat(l,"/task/").concat(r,"/status"):"/api/organizations/".concat(s,"/chat_conversations/").concat(l,"/task/").concat(r,"/status"),{data:S,isLoading:C,error:k}=(0,i.Sk)(w,{refetchInterval:!!m&&1e3*b,enabled:!!(c&&l&&s&&r),meta:{noToast:!0}}),N=(null==S?void 0:S.status)!==void 0&&!(0,o.i3)(null==S?void 0:S.status);return(0,g.useEffect)(()=>{if(c&&l&&s&&r)if(N)h(!1),j(void 0),_(),x(0);else if(k){if(!(null==S?void 0:S.started_at))return void h(!1);x(e=>{let t=e+1,a=f.c9.fromISO(S.started_at).plus({hours:3}),s=f.c9.now();return h(t<3&&s<a),t})}else S&&!N&&(x(0),j(r))},[c,r,N,k,_,s,l,S,j]),(0,g.useEffect)(()=>{if(!(null==S?void 0:S.started_at)||!m)return;let e=setInterval(()=>{let e=function(e,t){let a=f.c9.fromISO(e),s=f.c9.now().diff(a,"seconds").seconds;for(let e of t)if(!e.durationSeconds||s<e.durationSeconds)return e.intervalSeconds;return 30}(S.started_at,v);e!==b&&M(e)},1e3*b);return()=>clearInterval(e)},[null==S?void 0:S.started_at,m,v,b]),{compassStatus:S,isLoading:C,error:k,completed:N}}let M=e=>{var t,a;return null==e||null==(a=e.agents)||null==(t=a[0])?void 0:t.name};function _(e){let t=(0,m.A)(),a=M(e);return a||(e.status!==o.zu.Completed?t.formatMessage({defaultMessage:"Researching...",id:"eD084+/kcH"}):t.formatMessage({defaultMessage:"Done researching",id:"/ONMTL4lXm"}))}let j=h.Ik({thought:h.Yj()});function w(e){let t=null==e?void 0:e.agents[0];return(0,g.useMemo)(()=>{var e,a,s;let n=null==t||null==(e=t.annotated_snippets[0])?void 0:e.thinking_blocks,l=n&&n.length>0?n[0]:void 0;if(l)return l.thinking;let r=null==t||null==(s=t.annotated_snippets[0])||null==(a=s.tool_calls)?void 0:a.find(e=>"think"===e.tool_name);if(null==r?void 0:r.tool_input)try{let e=JSON.parse(r.tool_input),{data:t}=j.safeParse(e);return null==t?void 0:t.thought}catch(e){return}},[null==t?void 0:t.annotated_snippets])}function S(e){let t=Math.floor(e/1e3),a=Math.floor(t/60),s=Math.floor(a/60);return s>0?"".concat(s,"h ").concat(a%60,"m"):a>0?"".concat(a,"m ").concat(t%60,"s"):t>0?"".concat(t,"s"):"0s"}function C(e){let{startedAt:t,completedAt:a}=e,[n,l]=(0,g.useState)(()=>f.c9.now());if((0,g.useEffect)(()=>{if(!t||a)return;let e=setInterval(()=>{l(f.c9.now())},1e3);return()=>clearInterval(e)},[t,a,l]),!t)return"Starting";let r=f.c9.fromISO(t);if(a){let e=f.c9.fromISO(a).diff(r,"milliseconds").milliseconds;return e<=0?"Starting":(0,s.jsx)(s.Fragment,{children:S(e)})}let i=n.diff(r,"milliseconds").milliseconds;return i<=1e3?"Starting":(0,s.jsx)(s.Fragment,{children:S(i)})}function k(e){let{thought:t,className:a}=e;return t?(0,s.jsx)("div",{className:(0,u.A)("text-text-100 font-claude-response-body",a),children:(0,s.jsx)(r.fP,{text:t})}):null}}}]);