try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="4170cc0d-bbae-4a1d-96e2-30ead030af2e",e._sentryDebugIdIdentifier="sentry-dbid-4170cc0d-bbae-4a1d-96e2-30ead030af2e")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:anthropic-apps":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[30923],{0xbdad302d:(e,t,n)=>{n.d(t,{$D:()=>m,Ey:()=>_,I5:()=>b,Oo:()=>T,QJ:()=>y,XY:()=>h,Z1:()=>Q,_Y:()=>M,ct:()=>C,eG:()=>I,gn:()=>w,jJ:()=>v,oz:()=>S,pC:()=>A,ts:()=>G});var r=n(0x11e751567),s=n(0xf32c56dd),a=n(0x12c9046cd),i=n(0x14de19ae8),u=n(0x49fac030),o=n(0xac309a83),l=n(0xe670e093),c=n(0x22f291c2a),d=n(0x17e725145),p=n(0xfc89b4a4),f=n(0x21687185c),g=n(0xe6c3f31e);function h(e){return"shared_session"===e.type}function v(e){if(h(e))return e.session;let{type:t,...n}=e;return{...n,type:"session"}}function y(){return(0,o.fS)("yukon_gold")}let m=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{activeOrganization:n}=(0,i.YL)(),r=null==n?void 0:n.uuid,s=(0,a.iC)("/v1/sessions",{queryKey:[u.Rv,{orgUuid:r}],enabled:!!n&&e,staleTime:3e4,refetchInterval:t,pageParamName:"after_id",getNextPageParam:e=>e.has_more&&e.last_id?e.last_id:void 0,headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29","anthropic-client-feature":"ccr",...r?{"x-organization-uuid":r}:{}},meta:{noToast:!0}}),{hasNextPage:o,isFetchingNextPage:l,fetchNextPage:c,isError:d}=s,f=s.data;return(0,p.useEffect)(()=>{!o||l||d||c()},[o,l,c,d]),{data:(0,p.useMemo)(()=>{var e,t,n,r;if(!(null==f?void 0:f.pages))return;let s=f.pages.flatMap(e=>e.data);return{data:s,has_more:!1,first_id:null!=(n=null==(e=s[0])?void 0:e.id)?n:null,last_id:null!=(r=null==(t=s[s.length-1])?void 0:t.id)?r:null}},[null==f?void 0:f.pages]),isLoading:s.isLoading,isError:s.isError,error:s.error,refetch:s.refetch,isFetching:s.isFetching}};function _(e,t,n){if(0===t.length&&0===n.length)return e;let r="<uploaded_files>\n"+[...n.map(e=>"<file><file_path>".concat(e.path||e.file_name,"</file_path></file>")),...t.map(e=>{let t="<file_path>".concat(e.path||e.file_name,"</file_path>"),n=e.file_uuid?"<file_uuid>".concat(e.file_uuid,"</file_uuid>"):"";return"<file>".concat(t).concat(n,"</file>")})].join("\n")+"\n</uploaded_files>";return"".concat(r,"\n\n").concat(e)}function b(e,t){return{uuid:(0,l.b)(),session_id:t,type:"user",parent_tool_use_id:null,message:{role:"user",content:e}}}let w=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,i.YL)(),r=null==n?void 0:n.uuid;return(0,a.Sk)("/v1/sessions/".concat(e),{queryKey:[u.Ex,{orgUuid:r,sessionId:e}],enabled:!!n&&t&&!!e,meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29","anthropic-client-feature":"ccr",...r?{"x-organization-uuid":r}:{}}})};function S(){let e=E();return(0,p.useCallback)(t=>{let{initialMessage:n,title:r,customPrompt:s,model:a,gitRepoUrl:i,sourceBranch:u,outputBranch:o,environmentId:l,mcpConfig:c,mcpTools:d}=t,p=[];n&&p.push({type:"event",data:n});let f=[],g=[];return i&&o&&(f.push({type:"git_repository",url:i,...u&&{revision:"refs/heads/".concat(u)}}),g.push({type:"git_repository",git_info:{type:"github",repo:i.split("github.com/")[1],branches:[o]}})),e.mutateAsync({title:r,events:p,environment_id:l,session_context:{sources:f,outcomes:g,mcp_config:c,mcp_tools:d,...void 0!==s?{custom_system_prompt:s}:{},...void 0!==a?{model:a}:{}}})},[e])}let E=()=>{let{activeOrganization:e}=(0,i.YL)(),t=(0,d.useQueryClient)(),n=null==e?void 0:e.uuid;return(0,a.L2)("/v1/sessions","POST",{onMutate:e=>{if("config_id"in e&&"yukon_gold"===e.config_id)throw Error("Invalid config_id; use the other hook")},onSuccess:e=>{t.setQueryData([u.Rv,{orgUuid:n}],t=>{if(!(null==t?void 0:t.pages)||0===t.pages.length)return{pages:[{data:[e],has_more:!1,first_id:e.id,last_id:e.id}],pageParams:[void 0]};let[n,...r]=t.pages;return{...t,pages:[{...n,data:[e,...n.data],first_id:e.id},...r]}})},meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29","anthropic-client-feature":"ccr",...n?{"x-organization-uuid":n}:{}}})};function I(){let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,a.L2)("/api/organizations/".concat(t,"/dust/generate_title_and_branch"),"POST")}function M(){let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,a.L2)("/api/organizations/".concat(t,"/dust/generate_session_title"),"POST")}function x(e,t,n){return e.map(e=>({...e,data:e.data.map(e=>e.id===t?n(e):e)}))}function L(e,t){return{onMutate:async n=>{let r=[u.Rv,{orgUuid:e}],s=[u.Ex,{orgUuid:e,sessionId:n.sessionId}];await Promise.all([t.cancelQueries({queryKey:r}),t.cancelQueries({queryKey:s})]);let a=t.getQueryData(r),i=t.getQueryData(s);return t.setQueryData(r,e=>(null==e?void 0:e.pages)?{...e,pages:x(e.pages,n.sessionId,e=>({...e,...n.optimisticUpdate}))}:e),t.setQueryData(s,e=>e?{...e,...n.optimisticUpdate}:e),{previousSessionsList:a,previousSession:i}},onError:(n,r,s)=>{(null==s?void 0:s.previousSessionsList)&&t.setQueryData([u.Rv,{orgUuid:e}],s.previousSessionsList),(null==s?void 0:s.previousSession)&&t.setQueryData([u.Ex,{orgUuid:e,sessionId:r.sessionId}],s.previousSession)},onSuccess:(n,r)=>{t.setQueryData([u.Rv,{orgUuid:e}],e=>(null==e?void 0:e.pages)?{...e,pages:x(e.pages,r.sessionId,()=>n)}:e),t.setQueryData([u.Ex,{orgUuid:e,sessionId:r.sessionId}],n)}}}function T(){let{activeOrganization:e}=(0,i.YL)(),t=(0,d.useQueryClient)(),n=null==e?void 0:e.uuid,r=L(n,t);return(0,a.L2)(e=>"/v1/sessions/".concat(e.sessionId),"PATCH",{transformVariables:e=>({title:e.title,session_status:e.session_status}),onMutate:e=>r.onMutate({sessionId:e.sessionId,optimisticUpdate:e}),onError:r.onError,onSuccess:r.onSuccess,meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29","anthropic-client-feature":"ccr",...n?{"x-organization-uuid":n}:{}}})}function A(){let{activeOrganization:e}=(0,i.YL)(),t=(0,d.useQueryClient)(),n=null==e?void 0:e.uuid,r=L(n,t);return(0,a.L2)(e=>"/v1/sessions/".concat(e.sessionId,"/archive"),"POST",{transformVariables:()=>({}),onMutate:e=>r.onMutate({sessionId:e.sessionId,optimisticUpdate:{session_status:"archived"}}),onError:r.onError,onSuccess:r.onSuccess,meta:{noToast:!0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29","anthropic-client-feature":"ccr",...n?{"x-organization-uuid":n}:{}}})}let R=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r="/v1/sessions/ws/".concat(t,"/subscribe"),s=new URLSearchParams;s.append("organization_uuid",e),n.replay&&s.append("replay","true");let a=s.toString();a&&(r+="?".concat(a));let i="https:"===window.location.protocol?"wss:":"ws:";return"".concat(i,"//").concat(window.location.host).concat(r)},k=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,i.YL)(),r=null==n?void 0:n.uuid,s=(0,a.iC)("/v1/sessions/".concat(e,"/events"),{queryKey:[u.ri,{orgUuid:r,sessionId:e}],enabled:!!n&&t,pageParamName:"after_id",getNextPageParam:e=>{var t;if(!e.has_more)return;let n=e.last_id||(null==(t=e.data[e.data.length-1])?void 0:t.uuid)||null;return null!=n?n:void 0},headers:{"anthropic-version":"2023-06-01","anthropic-beta":"ccr-byoc-2025-07-29","anthropic-client-feature":"ccr",...r?{"x-organization-uuid":r}:{}},meta:{noToast:!0}}),{hasNextPage:o,isFetchingNextPage:l,fetchNextPage:c,isError:d}=s,f=s.data;return(0,p.useEffect)(()=>{!o||l||d||c()},[o,l,c,d]),{data:(0,p.useMemo)(()=>{var e,t,n,r;if(!(null==f?void 0:f.pages))return;let s=f.pages.flatMap(e=>e.data);return{data:s,has_more:!1,first_id:null!=(n=null==(e=s[0])?void 0:e.uuid)?n:null,last_id:null!=(r=null==(t=s[s.length-1])?void 0:t.uuid)?r:null}},[null==f?void 0:f.pages]),isLoading:s.isLoading,isError:s.isError,error:s.error,refetch:s.refetch,isFetching:s.isFetching}};class P{[Symbol.asyncIterator](){if(this.started)throw Error("Stream can only be iterated once");return this.started=!0,this}next(){return this.queue.length>0?Promise.resolve({done:!1,value:this.queue.shift()}):this.isDone?Promise.resolve({done:!0,value:void 0}):this.hasError?Promise.reject(this.hasError):new Promise((e,t)=>{this.readResolve=e,this.readReject=t})}enqueue(e){if(this.readResolve){let t=this.readResolve;this.readResolve=void 0,this.readReject=void 0,t({done:!1,value:e})}else this.queue.push(e)}done(){if(this.isDone=!0,this.readResolve){let e=this.readResolve;this.readResolve=void 0,this.readReject=void 0,e({done:!0,value:void 0})}}error(e){if(this.hasError=e,this.readReject){let t=this.readReject;this.readResolve=void 0,this.readReject=void 0,t(e)}}return(){return this.isDone=!0,this.returned&&this.returned(),Promise.resolve({done:!0,value:void 0})}constructor(e){this.returned=e,this.queue=[],this.isDone=!1,this.started=!1}}function C(e,t,n,s,a){let o=!(arguments.length>5)||void 0===arguments[5]||arguments[5],h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],v=arguments.length>7?arguments[7]:void 0,y=arguments.length>8?arguments[8]:void 0,{data:m,isLoading:_,isError:b,refetch:w}=k(e,o),{streamedMessages:S,interrupt:E,inputStreamRef:I,ensureConnected:M,connectionState:x,lastMessageTime:L,permissionMode:T,setPermissionMode:A}=function(e,t,n,s,a){let o=!(arguments.length>5)||void 0===arguments[5]||arguments[5],l=!(arguments.length>6)||void 0===arguments[6]||arguments[6],h=arguments.length>7?arguments[7]:void 0,v=arguments.length>8?arguments[8]:void 0,y=(0,p.useRef)(null),m=(0,p.useRef)(null),_=(0,p.useRef)(!1),b=(0,p.useRef)(0),w=(0,p.useRef)(null),S=(0,p.useRef)(null),E=(0,p.useRef)(null),[I,M]=(0,p.useState)([]),[x,L]=(0,p.useState)("disconnected"),[T,A]=(0,p.useState)(null),[k,C]=(0,p.useState)(null!=v?v:"default"),G=(0,f.Tk)(e),Q=(0,p.useRef)(e),q=(0,p.useCallback)(()=>{_.current=!0,L("disconnected"),A(null),w.current&&(clearTimeout(w.current),w.current=null),m.current&&(m.current.abort(),m.current=null),E.current&&(E.current.done(),E.current=null),y.current=null,S.current=null,b.current=0},[]);(0,p.useEffect)(()=>{Q.current!==e&&(q(),M([]),L("disconnected"),A(null),b.current=0,Q.current=e)},[e,q]);let{activeOrganization:U}=(0,i.YL)(),Y=null==U?void 0:U.uuid,z=(0,d.useQueryClient)(),V=(0,p.useRef)(s);V.current=s;let O=(0,p.useCallback)(()=>{var t;if(!o||!Y||!e||y.current&&S.current===e)return;q(),_.current=!1,L("connecting"),S.current=e,m.current=new AbortController,E.current=new P;let s=(0,c.P)({prompt:E.current,websocket:{url:R(Y,e)},abortController:m.current,mcpServers:a,canUseTool:(t=V,async(e,n,s)=>{var a;if(!r.c.REQUIRES_INPUT.has(e)){let[t,n,r]=e.split("__");if("mcp"!==t||!n||!r)return{behavior:"deny",message:"Invalid tool name format"}}let i=await t.current(e,n,s);return D(e,null!=(a=i.updatedInput)?a:n,i.decision)})});(null==h?void 0:h.maxThinkingTokens)!==void 0&&s.setMaxThinkingTokens(h.maxThinkingTokens),v&&"default"!==v&&s.setPermissionMode(v);let i=null;(async()=>{var e,t,n;try{let n=new Map,r=!0;for await(let a of(i=setTimeout(()=>{r&&L("connected")},500),s)){if(r&&(r=!1,clearTimeout(i),b.current=0,L("connected")),A(Date.now()),"system"===a.type&&a.permissionMode&&(!v||"default"===v)&&C(a.permissionMode),M(e=>a.uuid&&e.some(e=>e.uuid===a.uuid)?e:[...e,{...a,receivedStreamAt:Date.now()}]),"assistant"===a.type&&"message"in a){let t=null==(e=a.message)?void 0:e.content;if(Array.isArray(t))for(let e of t)"tool_use"===e.type&&e.id&&e.name&&n.set(e.id,{name:e.name,id:e.id,input:e.input})}if("user"===a.type&&"message"in a){let e=null==(t=a.message)?void 0:t.content;if(Array.isArray(e)){for(let t of e)if("tool_result"===t.type&&t.tool_use_id){let e=n.get(t.tool_use_id),r=(null==e?void 0:e.name)==="mcp__git__git_push",s=(null==e?void 0:e.name)==="Bash"&&function(e){if(!e||"object"!=typeof e)return!1;let t=e.command;return"string"==typeof t&&/^\s*git\s+push\b/.test(t)}(e.input);(r||s)&&z.invalidateQueries({queryKey:[u.i8],refetchType:"all"})}}}}}catch(r){i&&clearTimeout(i);let e=_.current,t=null==(n=m.current)?void 0:n.signal.aborted;if(_.current=!1,y.current===s&&(L("disconnected"),y.current=null),l&&!e&&!t&&r instanceof Error&&"WebSocket connection aborted by user"!==r.message){let e=b.current;if(e<5){b.current=e+1;let t=1e3*Math.pow(2,e),n=Math.random()*t*.5;w.current=setTimeout(()=>{O()},t+n)}}}})(),y.current=s,n(e=>{var t;y.current===s&&(null==(t=E.current)||t.enqueue(e))})},[o,Y,e,q,n,l,a,z,null==h?void 0:h.maxThinkingTokens,v]);(0,p.useEffect)(()=>()=>q(),[q]),(0,p.useEffect)(()=>{if(!T||"connected"!==x||(0,g.m)(I,G))return;let e=3e5-(Date.now()-T);if(e<=0)return void q();let t=setTimeout(()=>{q()},e);return()=>{clearTimeout(t)}},[T,x,I,G,q]);let N=(0,p.useCallback)(()=>{y.current&&(_.current=!0,y.current.interrupt())},[]),K=(0,p.useCallback)(e=>{C(e),y.current&&y.current.setPermissionMode(e)},[]);return{streamedMessages:I,interrupt:N,inputStreamRef:E,ensureConnected:(0,p.useCallback)(()=>{y.current||(b.current=0,O())},[O]),connectionState:x,lastMessageTime:T,permissionMode:k,setPermissionMode:K}}(e,t,(0,p.useCallback)(async e=>{var t;let n=await w(),r=new Set,s=null==(t=n.data)?void 0:t.pages;if(s)for(let e of s)for(let t of e.data)t.uuid&&r.add(t.uuid);return N.current.forEach(t=>{t.session_id&&t.uuid&&!r.has(t.uuid)&&e(t)}),n},[w]),n,s,o&&!b,h,v,y),C=(0,f.Tk)(e),G=(0,f.jT)(),Q=(0,f.Ou)(e=>e.removePendingMessage),q=(0,f.Ou)(e=>e.clearPendingMessages),U=(0,p.useMemo)(()=>{if(_||!m)return[];let e=new Set;return m.data.filter(t=>!(!t.uuid||e.has(t.uuid))&&(e.add(t.uuid),!0))},[_,m]),Y=(0,p.useMemo)(()=>{let e=new Map;for(let t of U)t.uuid&&e.set(t.uuid,t);for(let t of S)t.uuid&&e.set(t.uuid,t);return Array.from(e.values())},[U,S]);(0,p.useEffect)(()=>{for(let t of Y)t.uuid&&Q(e,t.uuid)},[Y,e,Q]);let z=(0,p.useCallback)(t=>{var n;let r={uuid:(0,l.b)(),type:"user",session_id:e,parent_tool_use_id:null,message:{role:"user",content:t}};G(e,r),null==(n=I.current)||n.enqueue(r)},[G,e,I]),V=(0,p.useCallback)((e,t,n,r)=>{var s;let a={type:"control_response",response:{subtype:"success",request_id:e,response:{toolUseID:t,...D(e,n,r)}}};M(),null==(s=I.current)||s.enqueue(a)},[M,I]),O=(0,p.useMemo)(()=>{if(0===C.length)return[];let e=new Set;for(let t of Y)e.add(t.uuid);return C.filter(t=>!e.has(t.uuid))},[C,Y]),N=(0,p.useRef)([]);N.current=O,(0,p.useEffect)(()=>{(a||O.length>0)&&M()},[M,a,O.length]);let K=(0,p.useCallback)(()=>{E(),q(e)},[E,q,e]),j=(0,p.useCallback)(()=>{E(),setTimeout(()=>{M()},100)},[E,M]),F=(0,p.useMemo)(()=>(0,g.m)(Y,C),[Y,C]);return{loadingInitialMessages:_,initialMessagesError:b,sendMessage:z,sendToolDecision:V,stopSession:K,initialMessages:null==m?void 0:m.data,streamedMessages:S,messages:Y,pendingMessages:O,ensureConnected:M,connectionState:x,lastMessageTime:L,retry:j,isSessionRunning:F,permissionMode:T,setPermissionMode:A}}function D(e,t,n){let r;return"deny"===n?{behavior:"deny",message:"Denied by user"}:("ExitPlanMode"===e?r=[{type:"setMode",mode:"default",destination:"session"}]:"always"===n&&(r=[{type:"replaceRules",rules:[{toolName:e}],behavior:"allow",destination:"localSettings"}]),{behavior:"allow",updatedInput:t,updatedPermissions:r})}function G(){let{activeOrganization:e}=(0,i.YL)(),{track:t}=(0,s.st)(),n=(0,a.L2)("/api/organizations/".concat(null==e?void 0:e.uuid,"/sessions"),"POST",{enabled:!!e,onSuccess:e=>{t({event_key:"claudeai.yukon_gold.session_created",session_id:e.session_id})}});return(0,p.useCallback)(e=>{let{initialMessage:t,model:r,conversationUuid:s,mcpTools:a}=e,i=[];return t&&i.push({type:"event",data:t}),n.mutateAsync({title:"",events:i,config_id:"yukon_gold",model:r,conversation_uuid:s,mcp_tools:a})},[n])}function Q(){let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,a.L2)(e=>{let{sessionId:n}=e;return"/api/organizations/".concat(t,"/sessions/").concat(n,"/update")},"POST",{enabled:!!t})}},0xe6c3f31e:(e,t,n)=>{function r(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"remote";return"local"===n?function(e){if(0===e.length)return!1;for(let t=e.length-1;t>=0;t--){let n=e[t];if((null==n?void 0:n.type)==="result")break;if((null==n?void 0:n.type)==="user")return!s(n)&&!function(e){var t,n,r;let s=null==(t=e.message)?void 0:t.content;return a("string"==typeof s?s:Array.isArray(s)&&null!=(r=null==(n=s[0])?void 0:n.text)?r:"")}(n);if((null==n?void 0:n.type)==="assistant")return!i(n)}return!1}(e):t.length>0||function(e){let t=e.filter(e=>"env_manager_log"!==e.type),n=t[t.length-1];return!n||"result"!==n.type&&("user"===n.type?!s(n):"assistant"!==n.type||!i(n))}(e)}function s(e){var t,n,r;let s=null==(t=e.message)?void 0:t.content;if(Array.isArray(s)){let e=null!=(r=null==(n=s[0])?void 0:n.text)?r:"";return"[Request interrupted by user]"===e||"[Request interrupted by user for tool use]"===e}return!1}function a(e){return e.includes("<command-name>")||e.includes("<local-command-stdout>")||e.includes("<local-command-stderr>")}function i(e){var t,n;if(e.isApiErrorMessage||(null==(t=e.message)?void 0:t.stop_reason)==="end_turn")return!0;let r=null==(n=e.message)?void 0:n.content;if(Array.isArray(r)&&r.length>0){let e=r[r.length-1];if((null==e?void 0:e.type)==="text")return!0}return!1}n.d(t,{O:()=>a,m:()=>r})},0x11e751567:(e,t,n)=>{n.d(t,{c:()=>r});let r={CUSTOM_UI:new Set(["ExitPlanMode"]),REQUIRES_INPUT:new Set(["AskUserQuestion","ExitPlanMode"])}},0x18175ce17:(e,t,n)=>{n.d(t,{Cg:()=>U,Dd:()=>L,FZ:()=>M,LN:()=>S,TI:()=>k,X0:()=>z,Ys:()=>Q,dJ:()=>C,eL:()=>T,fe:()=>V,hm:()=>R,kO:()=>G,ob:()=>Y,ph:()=>I,qi:()=>P,tS:()=>w,vm:()=>D,xc:()=>E,z3:()=>x});var r=n(0x17aa9d8d7),s=n(0x12c9046cd),a=n(0x14de19ae8),i=n(0x139b5e710),u=n(0x1016c6ed2),o=n(0x49fac030),l=n(0xac309a83),c=n(0x1b813d90),d=n(0x1bd175d8c),p=n(0x78b33fbd),f=n(0x17e725145),g=n(0x4d348f95),h=n(0xfc89b4a4),v=n(0x1ab0d1ca1),y=n(0x21fe74567),m=n(0x4d9fc74e),_=n(0xe824fb1c),b=n(0xc6857cab);let w=e=>e.type===c.v8.GITHUB?{sync_source_type:c.v8.GITHUB,sync_source_config:e.config}:e.type===c.v8.GDRIVE?{sync_source_type:c.v8.GDRIVE,sync_source_config:e.config}:null,S=()=>{let{activeOrganization:e}=(0,a.YL)(),t=null==e?void 0:e.uuid;return(0,s.Sk)("/api/organizations/".concat(t,"/sync/settings"),{queryKey:[o._V,{orgUuid:t}],enabled:!!e})},E=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,a.YL)(),n=null==t?void 0:t.uuid,r=(0,f.useQueryClient)();return(0,s.Qv)("/api/organizations/".concat(n,"/sync/settings"),"PUT",(e,t)=>{let{type:n,enabled:r}=e;t||(t=[]);let s=t.map(e=>e.type===n?{...e,enabled:r}:e);return s.some(e=>e.type===n)?s:[...t,{type:n,enabled:r}]},{queryKey:[o._V,{orgUuid:n}],enabled:!!t,onSuccess:async function(){for(var t,s=arguments.length,a=Array(s),i=0;i<s;i++)a[i]=arguments[i];await r.invalidateQueries({queryKey:[o._V,{orgUuid:n}]}),await (null==(t=e.onSuccess)?void 0:t.call(e,...a))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},I=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,a.YL)(),n=null==t?void 0:t.uuid,r=(0,f.useQueryClient)(),i=(0,l.fS)("kingfisher_enabled"),u=(0,l.fS)("apps_use_bananagrams"),c=(0,p.useLayer)("trials_freemium").get("free_integrations",!1);return(0,s.Qv)("/api/organizations/".concat(n,"/sync/settings/config"),"POST",(e,t)=>{let{type:n,config:r}=e;return t||(t=[]),t.map(e=>e.type===n?{...e,config:{...e.config,...r}}:e)},{queryKey:[o._V,{orgUuid:n}],enabled:!!(t&&(i||c)&&u),onSuccess:async function(){for(var t,s=arguments.length,a=Array(s),i=0;i<s;i++)a[i]=arguments[i];await r.invalidateQueries({queryKey:[o._V,{orgUuid:n}]}),await (null==(t=e.onSuccess)?void 0:t.call(e,...a))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},M=e=>{let{callerIdentifier:t,successParam:n,handleOpen:r}=e,s=(0,g.useSearchParams)(),a=(0,h.useRef)(!1);(0,h.useEffect)(()=>{!s.has(n)||a.current||t&&t!==s.get(n)||(a.current=!0,((e,t)=>{let n=new URLSearchParams(Array.from(t.entries()));n.delete(e);let r=n.toString()?"?".concat(n.toString()):"",s=window.location.pathname+r;window.history.replaceState({...window.history.state,as:s,url:s},"",s)})(n,s),r())},[s,t,r,n])},x=e=>{let t;return t=e.status.state,[c.I5.CREATED,c.I5.PENDING,c.I5.UPDATING].includes(t)},L=e=>[c.I5.FAILED,c.I5.UPDATE_FAILED].includes(e.status.state),T=()=>{let{addError:e}=(0,i.Yf)(),t=(0,f.useQueryClient)();return(n,r)=>{(e=>{if(e instanceof u.LG)return e instanceof u.LG&&"access_denied"===e.errorCode})(n)&&(e("Please try again. You may need to reconnect with your ".concat(c.sb[r.sync_source_type]," account."),{error:n}),o.ku.forEach(e=>{t.invalidateQueries({queryKey:[e]})}),t.invalidateQueries({queryKey:[o.GC]}))}},A={[c.v8.GCAL]:"enabled_foccacia",[c.v8.GMAIL]:"enabled_sourdough"},R=e=>{let t=(0,a.mV)(),{data:n}=S(),r=!!(Array.isArray(n)&&n.find(t=>t.type===e&&t.enabled));return!t||r},k={"https://mcp-server-gcal-586545259222.us-central1.run.app/sse":c.v8.GCAL,"https://mcp-server-gcal-586545259222.us-central1.run.app/mcp":c.v8.GCAL,"https://gcal.mcp.claude.com/mcp":c.v8.GCAL,"https://gcal.mcp.staging.ant.dev/mcp":c.v8.GCAL,"https://mcp-server-gmail-110131437935.us-central1.run.app/sse":c.v8.GMAIL,"https://mcp-server-gmail-110131437935.us-central1.run.app/mcp":c.v8.GMAIL,"https://gmail.mcp.claude.com/mcp":c.v8.GMAIL,"https://gmail.mcp.staging.ant.dev/mcp":c.v8.GMAIL,"https://api.anthropic.com/mcp/gdrive/sse":c.v8.GDRIVE,"https://api.anthropic.com/mcp/gdrive/mcp":c.v8.GDRIVE,"https://api-staging.anthropic.com/mcp/gdrive/sse":c.v8.GDRIVE,"https://api-staging.anthropic.com/mcp/gdrive/mcp":c.v8.GDRIVE},P=e=>{let t;return t=(0,_.Uz)({type:"remote"}),t.find(t=>t.url&&k[t.url]===e)},C=e=>!!P(e),D=()=>(0,l.fS)("enabled_brioche"),G=()=>(0,l.fS)("mcp_gdrive"),Q=e=>{let t=D(),n=G(),r=R(e),s=(e=>{let t="cinnabon_enabled";switch(e){case c.v8.GCAL:case c.v8.GMAIL:t="pumpernickel_enabled";break;case c.v8.GDRIVE:t="kingfisher_enabled";break;default:t="cinnabon_enabled"}let n=(0,l.fS)(t),r=(0,p.useLayer)("trials_freemium").get("free_integrations",!1),s=n||(e===c.v8.GCAL||e===c.v8.GMAIL||e===c.v8.GDRIVE)&&r;return!b.env.NEXT_PUBLIC_DISABLE_INTEGRATIONS&&s})(e),a=C(e),i=e===c.v8.GDRIVE?n:t;return!!(s&&(r||i&&a))},q=e=>"sfdc"===e?"salesforce":"gdrive"===e?"mcp/drive":e,U=e=>{let t=P(e);return t?{isFetched:!0,isAuthenticated:!!t.isConnected,server_uuid:t.uuid}:{isFetched:!1,isAuthenticated:!1,server_uuid:void 0}},Y=function(e){let{callerIdentifier:t,handleAuthSuccess:n,pathname:r,queryString:u}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=G(),l=D(),p=e===c.v8.GDRIVE?o:l,_=((e,t)=>{let{pathname:n,queryString:r,callerIdentifier:s}=t,a=P(e),i=Q(e),u=U(e),o=s?"".concat(e,"_success=").concat(s).concat(r?"&".concat(r):""):r,l=(0,m.QD)({pathname:n,queryString:o});return{isAuthenticated:!!i&&!!a&&u.isAuthenticated,startAuth:()=>{i&&a&&l({uuid:a.uuid,url:a.url})},disconnect:()=>{},isFetched:!!a&&u.isFetched}})(e,{pathname:r,queryString:u,callerIdentifier:t}),{activeOrganization:b}=(0,a.YL)(),w=null==b?void 0:b.uuid,S=(0,g.usePathname)(),E=(0,g.useSearchParams)(),{addSuccess:I}=(0,i.Yf)(),x=(0,v.A)(),L=Q(e),T=(0,f.useQueryClient)(),A=(0,d.V)(),{data:R,isFetched:k}=(0,s.Sk)("/api/organizations/".concat(w,"/sync/").concat(q(e),"/auth"),{queryKey:["sync_".concat(e,"_auth_status"),{orgUuid:w}],enabled:!!(b&&L)}),C=(0,h.useRef)(!1),{mutate:Y}=(0,s.L2)("/api/organizations/".concat(w,"/sync/").concat(q(e),"/auth/start"),"POST",{enabled:!!(b&&L)&&!p,onSuccess:e=>{window.location.href=e.redirect_url}});M({callerIdentifier:t,successParam:"".concat(e,"_success"),handleOpen:()=>{I(x.formatMessage({defaultMessage:"Connected to {integrationName}",id:"g0plFfAZAH"},{integrationName:c.sb[e]})),null==n||n(!0)}});let{mutate:z}=(0,s.L2)("/api/organizations/".concat(w,"/sync/").concat(q(e),"/auth"),"DELETE",{enabled:!!(b&&L)&&!p,onSuccess:()=>{T.invalidateQueries({queryKey:["sync_".concat(e,"_auth_status"),{orgUuid:w}]})}});return p&&_.isFetched?{..._,authBreakdown:{mcp:L&&_.isAuthenticated,firstParty:L&&!!(null==R?void 0:R.is_authenticated)},mcpServerGated:p}:{isAuthenticated:L&&!!(null==R?void 0:R.is_authenticated),startAuth:()=>{if(!C.current&&L){let n="".concat(e,"_success=").concat(t).concat(u?"&".concat(u):""),s=(0,y.d)({pathname:r||S,searchParams:E,queryString:n,shouldOpenInClaudeApp:A});if(A){window.location.href="/settings/connectors?open_in_browser=1&auth_start=".concat(e,"&origin=").concat(s);return}C.current=!0,Y({pre_auth_state:{origin:s},redirect_uri:new URL("/connect/".concat(q(e),"/callback"),window.location.origin).toString()})}},disconnect:z,isFetched:k,authBreakdown:{mcp:L&&_.isAuthenticated,firstParty:L&&!!(null==R?void 0:R.is_authenticated)},mcpServerGated:p}},z=(e,t)=>{var n,r;let s=D(),i=G(),u=e===c.v8.GDRIVE?i:s,o=Q(e),{account:l}=(0,a.YL)(),d=A[e];return!d||u?o:o&&(t?!!(null==t||null==(n=t.conversationSettings)?void 0:n[d]):!!(null==l||null==(r=l.settings)?void 0:r[d]))},V=()=>{let{account:e}=(0,a.YL)(),{mutate:t}=(0,r.yJ)();return{toggleIntegrationEnabled:(n,r)=>{if(!e)return;let s=A[n];s&&t({[s]:r})}}}},0x21687185c:(e,t,n)=>{n.d(t,{Ou:()=>a,Tk:()=>o,jT:()=>i});var r=n(0x394ef833),s=n(0x16784b660);let a=(0,r.v)()((0,s.Zr)(e=>({pendingMessages:{},addPendingMessage:(t,n)=>{e(e=>({pendingMessages:{...e.pendingMessages,[t]:[...e.pendingMessages[t]||[],n]}}))},clearPendingMessages:t=>{e(e=>({pendingMessages:{...e.pendingMessages,[t]:[]}}))},removePendingMessage:(t,n)=>{e(e=>({pendingMessages:{...e.pendingMessages,[t]:(e.pendingMessages[t]||[]).filter(e=>e.uuid!==n)}}))}}),{name:"session-pending-messages",storage:(0,s.KU)(()=>sessionStorage)})),i=()=>a(e=>e.addPendingMessage),u=[],o=e=>a(t=>{var n;return null!=(n=t.pendingMessages[e])?n:u})}}]);