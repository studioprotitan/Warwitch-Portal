try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="aff2a19d-35cd-40d0-8957-eba5fdb38325",e._sentryDebugIdIdentifier="sentry-dbid-aff2a19d-35cd-40d0-8957-eba5fdb38325")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:anthropic-apps":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[40252],{0x3cdfb8c4:(e,t,a)=>{function r(e){let t=e.lastIndexOf(".");return -1===t?"":e.substring(t+1).toLowerCase()}function n(e){let t=new AbortController,a=[];for(let a of e)if(a.aborted)return t.abort(),t.signal;for(let r of e){let e=()=>{t.abort(),a.forEach(e=>e())};r.addEventListener("abort",e),a.push(()=>r.removeEventListener("abort",e))}let r=t.signal;return r.cleanup=()=>{a.forEach(e=>e())},r}function o(e,t,a){let n=r(e.name),o=t.includes(n),i=!!a&&a.includes(e.type);return o||i}a.d(t,{NA:()=>n,QC:()=>r,QL:()=>o})},0x5267d157:(e,t,a)=>{a.d(t,{B:()=>i,o:()=>o});var r=a(0x22102fd88);a(0xfc89b4a4);var n=a(0x38e6572);class o extends Error{constructor(e,t,a){super(e),this.statusCode=t,this.fileName=a,this.name="UploadError"}}function i(e){switch(e.statusCode){case 400:return(0,r.jsx)(n.A,{defaultMessage:"Failed to upload “{fileName}”. The file format may not be supported or the file may be corrupted.",id:"Cf7tH0HDeT",values:{fileName:e.fileName}});case 413:return(0,r.jsx)(n.A,{defaultMessage:"“{fileName}” is too large. Choose a smaller file.",id:"fJHdaZIRcd",values:{fileName:e.fileName}});case 429:return(0,r.jsx)(n.A,{defaultMessage:"Too many upload attempts. Wait a moment and try again.",id:"/AyXW9R0Le"});default:return(0,r.jsx)(n.A,{defaultMessage:"Failed to upload “{fileName}”. You can try again.",id:"pQKS8jGiWa",values:{fileName:e.fileName}})}}},0x56ac793a:(e,t,a)=>{a.d(t,{Fw:()=>n,_S:()=>o,gs:()=>i,lm:()=>l});var r=a(0x1d4b03596);function n(e){return e.featureGates.wiggleEnabled}function o(e){let{orgUuid:t,conversationUuid:a}=e;if(!t||!a)throw Error("orgUuid and conversationUuid are required for wiggle uploads");return"/api/organizations/".concat(t,"/conversations/").concat(a,"/wiggle/upload-file")}async function i(e,t,a){if(!n(t))throw Error("Wiggle uploads are not enabled");let i=o(t);return(0,r.C)(e,i,a,{handlerName:"Wiggle"})}async function l(e,t,a){let{orgUuid:r,conversationUuid:n,wiggleEnabled:o}=t;if(!o)throw Error("Wiggle uploads are not enabled");if(!r||!n)throw Error("orgUuid and conversationUuid are required for wiggle file deletion");let i="/api/organizations/".concat(r,"/conversations/").concat(n,"/wiggle/delete-file"),l=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({file_uuid:e}),signal:a,credentials:"include"});if(!l.ok)throw Error("Wiggle: Delete failed: ".concat(l.status," ").concat(l.statusText," - File UUID: ").concat(e))}},0x597e433e:(e,t,a)=>{a.d(t,{XA:()=>o.XA,_F:()=>o._F,QC:()=>r.QC,cm:()=>i,eT:()=>n.e,F9:()=>n.F,cV:()=>u});var r=a(0x3cdfb8c4),n=a(0x1cae89638),o=a(0x1139502dd);function i(e){let{imagesEnabled:t=!1,outOfContextFilesEnabled:a=!1,wiggleEnabled:r=!1}=e,n=[];return r&&n.push(...o.rk),n.push(...o.Ap.map(e=>".".concat(e))),n.push(...o.pH.map(e=>".".concat(e))),n.push(...o.lg.map(e=>".".concat(e))),t&&n.push(...o.f9.map(e=>".".concat(e))),a&&n.push(...o.PC.map(e=>".".concat(e))),n}var l=a(0x1e3604791),s=a(0x1065e6d73),d=a(0x14de19ae8),c=a(0x371cc700);function u(){var e;let{account:t}=(0,d.YL)(),a=(0,c.B)(),r=null!=(e=null!=a?a:null==t?void 0:t.settings)?e:{},{value:n}=(0,l.N)(r);return!!(0,s.u9)()||n}a(0x14aef0225)},0xfd34bc37:(e,t,a)=>{a.d(t,{T:()=>o,d:()=>i});var r=a(0xe670e093),n=a(0xfc89b4a4);let o={current:(0,r.b)()};function i(){let e=(0,n.useRef)(o),t=(0,n.useCallback)(()=>{e.current.current=(0,r.b)()},[]);return[e.current.current,t]}},0x1065e6d73:(e,t,a)=>{a.d(t,{EG:()=>y,FX:()=>m,Gh:()=>f,JO:()=>C,UA:()=>_,Vx:()=>T,Vy:()=>g,Yl:()=>E,d6:()=>U,p0:()=>h,t5:()=>p,u9:()=>b,up:()=>F,ut:()=>v});var r=a(0x17aa9d8d7),n=a(0x12c9046cd),o=a(0x14de19ae8),i=a(0x139b5e710),l=a(0x49fac030),s=a(0xac309a83),d=a(0xfc89b4a4),c=a(0x1ab0d1ca1),u=a(0x156c4e43b);function f(){return(0,s.fS)("trials_and_tribulations_of_high_school_football")}function p(){var e,t;let a=(0,o.mV)(),r=(0,o.zm)(),{activeOrganization:i}=(0,o.YL)(),{data:s}=(0,n.Sk)("/api/organizations/".concat(null==i?void 0:i.uuid,"/feature_settings"),{queryKey:[l.RR,null==i?void 0:i.uuid],enabled:!!(null==i?void 0:i.uuid)&&a});return r?!!s&&!(null==(e=s.disabled_features)?void 0:e.includes("wiggle")):!a||!s||!(null==(t=s.disabled_features)?void 0:t.includes("wiggle"))}function g(){var e,t;let{activeOrganization:a}=(0,o.YL)(),r=(0,s.fS)("claudeai_default_wiggle_egress_enabled");return null!=(t=null==a||null==(e=a.settings)?void 0:e.enabled_wiggle_egress)?t:r}function m(){var e,t;let{activeOrganization:a}=(0,o.YL)();return null!=(t=null==a||null==(e=a.settings)?void 0:e.wiggle_egress_allowed_hosts)?t:[]}function h(){var e,t;let{activeOrganization:a}=(0,o.YL)(),r=w();return null!=(t=null==a||null==(e=a.settings)?void 0:e.wiggle_egress_hosts_template)?t:r}function v(){var e;let{account:t}=(0,o.YL)(),a=(0,s.fS)("claudeai_default_wiggle_egress_enabled"),r=(0,s.fS)("claudeai_default_wiggle_egress_enabled_without_spotlight");if(!(null==t?void 0:t.settings))return!1;let n=r||!!t.settings.wiggle_egress_spotlight_viewed_at;return null!=(e=t.settings.enabled_wiggle_egress)?e:!!n&&a}function _(){var e,t;let{account:a}=(0,o.YL)();return null!=(t=null==a||null==(e=a.settings)?void 0:e.wiggle_egress_allowed_hosts)?t:[]}function w(){return(0,s.T9)("claudeai_default_wiggle_egress_hosts_template","template","package_managers",u.Yj())}function y(){var e,t;let{account:a}=(0,o.YL)(),r=w();return null!=(t=null==a||null==(e=a.settings)?void 0:e.wiggle_egress_hosts_template)?t:r}function x(){var e,t;let{account:a}=(0,o.YL)(),r=(0,s.fS)("default_wiggle_on"),n=(0,s.P0)("wiggle_pro_default_on","default_enabled",void 0,u.zM().optional());if(null==a?void 0:a.settings)return null!=(t=null!=(e=a.settings.enabled_monkeys_in_a_barrel)?e:n)?t:r}function b(){let e=f(),t=p(),a=x();return!!e&&!!t&&a}function E(){let e=f(),t=p();return e&&t}function F(){var e;let t=(0,o.mV)(),{activeOrganization:a}=(0,o.YL)(),{data:r}=(0,n.Sk)("/api/organizations/".concat(null==a?void 0:a.uuid,"/feature_settings"),{queryKey:[l.RR,null==a?void 0:a.uuid],enabled:!!(null==a?void 0:a.uuid)&&t});return!t||!!r&&!(null==(e=r.disabled_features)?void 0:e.includes("skills"))}function C(){let e=b(),t=F(),a=(0,s.fS)("claudeai_skills");return!!e&&t&&a}function U(){let e=E(),t=(0,s.fS)("claudeai_skills");return e&&t}let T=()=>{let e=(0,c.A)(),{account:t}=(0,o.YL)(),{addSuccess:a}=(0,i.Yf)(),n=x(),l=p(),{mutate:s}=(0,r.yJ)(),u=(0,d.useRef)(null==t?void 0:t.settings);return(0,d.useEffect)(()=>{u.current=null==t?void 0:t.settings},[null==t?void 0:t.settings]),{isEnabled:n,toggleWiggle:(0,d.useCallback)(r=>{if(t&&l){if(r){var n,o;let t=null==(n=u.current)?void 0:n.enabled_artifacts_attachments,r=[];t&&r.push("Analysis Tool"),r.length>0&&a(e.formatMessage({defaultMessage:"Automatically disabled: {features}",id:"7StJBCedWA"},{features:r.join(", ")})),(null==(o=u.current)?void 0:o.preview_feature_uses_artifacts)||a(e.formatMessage({defaultMessage:"Automatically enabled: Artifacts",id:"v5zt5SRUyk"}))}s({enabled_monkeys_in_a_barrel:r,...r&&{enabled_artifacts_attachments:!1,preview_feature_uses_artifacts:!0}})}},[t,l,s,a,e])}}},0x1139502dd:(e,t,a)=>{a.d(t,{Ap:()=>l,BA:()=>s,PC:()=>u,XA:()=>U,_F:()=>y,eu:()=>v,f9:()=>i,fT:()=>_,gZ:()=>x,h8:()=>o,hJ:()=>m,hR:()=>F,lg:()=>d,mw:()=>w,n6:()=>E,pH:()=>h,qy:()=>C,rk:()=>c,wI:()=>g,x4:()=>f,xw:()=>p,yo:()=>b});var r=a(0x9845e38c),n=a(0xac309a83);let o=["jpg","jpeg","png","gif","webp"],i=o,l=["pdf"],s=["txt","py","ipynb","js","jsx","html","css","java","cs","php","c","cc","cpp","cxx","cts","h","hh","hpp","rs","R","Rmd","swift","go","rb","kt","kts","ts","tsx","m","mm","mts","scala","dart","lua","pl","pm","t","sh","bash","zsh","csv","log","ini","cfg","config","json","proto","prisma","yaml","yml","toml","sql","bat","md","coffee","tex","latex","gd","gdshader","tres","tscn","typst","rst","adoc","asciidoc","textile","creole","wiki","env","gitignore","dockerignore","editorconfig","prettierrc","eslintrc","gradle","sbt","cabal","podspec","gemspec","makefile","dockerfile","xml","rss","atom","graphql","gql","hbs","handlebars","mustache","twig","jinja","jinja2","j2","vue","svelte","glsl","hlsl","frag","vert","shader","elm","clj","cljs","erl","ex","exs","hs","nim","zig","fs","fsx","ml","mli","v","vsh","vv","pas","pp","inc","fish","csh","tcsh","ps1","psm1","psd1","tsv","tab","jsonl","ndjson","lock","ignore","gitattributes","gitmodules","htaccess","htpasswd","robots","sitemap"],d=s,c=["doc","pptx","zip"],u=["csv","xls","xlsx","xlsb","xlm","xlsm","xlt","xltm","xltx","ods","zip"],f=[...u],p=["txt","md","py","ipynb","js","jsx","html","css","java","cs","php","c","cc","cpp","cxx","cts","h","hh","hpp","rs","R","Rmd","swift","go","rb","kt","kts","ts","tsx","m","mm","mts","scala","dart","lua","pl","pm","t","sh","bash","zsh","log","ini","cfg","config","json","proto","yaml","yml","toml","sql","bat"],g=["bmp","ico","tiff","tif","psd","raw","cr2","nef","orf","sr2","mobi","jp2","jpx","jpm","mj2","svg","svgz","ai","eps","ps","indd","heic","mp4","mov","avi","mkv","wmv","flv","webm","mpeg","mpg","m4v","3gp","ogv","ogg","rm","rmvb","asf","amv","mpe","m1v","m2v","svi","3g2","roq","nsv","f4v","f4p","f4a","f4b","qt","hdmov","divx","div","m2ts","mts","vob","mp3","wav","wma","aac","flac","alac","aiff","opus","m4a","amr","awb","ra","mid","midi","mka","ttf","otf","woff","woff2","eot","sfnt","ttc","suit","doc","pptx","ppt","zip","rar","tar","gz","7z","pkg","deb","rpm","dmg","exe","msi","app","dng","xcf","blend","max","obj","fbx","3ds","dwg","dxf","skp","kmz"],m=[".DS_Store"],h=["docx","rtf","epub","odt","odp"],v=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.presentation","application/vnd.oasis.opendocument.spreadsheet","application/rtf","application/epub+zip"],_=["image/jpeg","image/png","image/gif","image/webp"],w=["application/pdf"],y={"image/jpeg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp","application/pdf":"pdf"},x=0x1e00000,b=2e3,E=2e3,F=.85;function C(){let e=(0,n.Je)();if(!e)return 15360;try{let t=e.getDynamicConfig("cai_file_upload_config").get("max_in_context_file_bytes",15360);if("number"==typeof t&&t>0)return t}catch(e){r.v.warn(r.u.FILE_UPLOAD,"Failed to fetch max_in_context_file_bytes from Statsig",{error:e})}return 15360}let U={maxFileSize:0x1e00000,maxImageSize:0xa00000,maxFilesPerBatch:20,maxFilesPerMessage:20,maxAttachmentsPerMessage:20,maxTotalUploadsPerMessage:20,maxFilesPerConversation:100,maxAttachmentsPerConversation:500,maxTokensPerFile:1e5,maxTokensPerMessage:2e5}},0x14aef0225:(e,t,a)=>{a.d(t,{e:()=>T,O:()=>P});var r=a(0x3cdfb8c4);class n{registerHandler(e){this.handlers.push(e)}async processFiles(e,t,a){let n=new AbortController,o=a?(0,r.NA)([a,n.signal]):n.signal;try{let a=this.matchFiles(e,t),r=this.validateFiles(a,t),n=r.filter(e=>e.valid),i=r.filter(e=>!e.valid),l=await this.preProcessFiles(n,t,o),s=await this.processFilesInternal(l,t,o),d=[],c=[];s.forEach(e=>{"type"in e&&"data"in e?d.push(e):"file"in e&&"error"in e&&c.push(e)});let u=[...i.map(e=>({file:e.file,error:Error(e.error||"Validation failed")})),...c];return{successful:d,failed:u}}catch(e){throw n.abort(),e}}matchFiles(e,t){return e.map(e=>{let a=this.handlers.find(a=>a.matches(e,t));return a?{file:e,handler:a,matched:!0}:{file:e,handler:null,matched:!1,error:"No handler available for file type: ".concat(e.name)}})}validateFiles(e,t){return e.map(e=>{var a,r;let{file:n,handler:o,matched:i}=e;if(!i||!o)return{file:n,handler:o,valid:!1,error:e.error||"No handler available for file: ".concat(n.name)};let l=null==(a=o.validate)?void 0:a.call(o,n,t);return{file:n,handler:o,valid:null==(r=null==l?void 0:l.valid)||r,error:null==l?void 0:l.error}})}async preProcessFiles(e,t,a){return Promise.all(e.map(async e=>{let{file:r,handler:n}=e;if(a.aborted)throw Error("Pre-processing cancelled for file: ".concat(r.name," (").concat(n.name," handler)"));let o=r;return n.preProcess&&(o=await n.preProcess(r,t,a)),{originalFile:r,processedFile:o,handler:n}}))}async processFilesInternal(e,t,a){return Promise.all(e.map(async e=>{let{processedFile:r,handler:n}=e;try{if(a.aborted)throw Error("Upload cancelled for file: ".concat(r.name," (").concat(n.name," handler)"));return await n.process(r,t,a)}catch(e){return{file:r,error:e instanceof Error?e:Error(String(e))}}}))}constructor(){this.handlers=[]}}var o=a(0x1139502dd),i=a(0x1a3383306);function l(e){return e.replace(/\0/g,"")}async function s(e,t,a){if(!t)throw Error("Organization UUID is required for document conversion");let r=new FormData;r.append("file",e);let n=await fetch("/api/organizations/".concat(t,"/convert_document"),{method:"POST",body:r,signal:a,credentials:"include"});if(!n.ok){var o,i,s,d,c,u,f,p;if(429===n.status){let e=Error("Too many file upload attempts. Please wait and try again later.");throw e.isRateLimit=!0,e.statusCode=429,e}if(413===n.status){let e=Error("Uploaded file is too large. Try uploading a smaller part of the document, or copy/pasting an excerpt from the file.");throw e.statusCode=413,e.errorType="file_too_large",e}let t={};try{t=await n.json()}catch(e){}let a=t;if("document_password_protected"===((null==(o=a.error)?void 0:o.error_code)||(null==(i=a.error)?void 0:i.errorCode)||(null==(d=a.error)||null==(s=d.details)?void 0:s.error_code)||(null==(u=a.error)||null==(c=u.details)?void 0:c.errorCode))){let t=Error("Document is password protected");throw t.errorCode="document_password_protected",t.fileName=e.name,t}if((null==(f=a.error)?void 0:f.type)==="invalid_file_type")throw Error('"'.concat(e.name,'" is not a supported file type.'));let r=Error("The file format may not be supported or the file may be corrupted.");throw r.statusCode=n.status,r.errorType="extraction_failed",r.originalMessage=(null==(p=a.error)?void 0:p.message)||"Document conversion failed",r}let g=await n.json();if(!g||"object"!=typeof g)throw Error('Could not process "'.concat(e.name,'". Please try uploading again.'));if(!g.file_name||!g.extracted_content)throw Error('Could not extract content from "'.concat(e.name,'". The file format may not be supported or the file may be corrupted.'));return g.extracted_content=l(g.extracted_content),g.file_name=l(g.file_name),g.file_type=l(g.file_type),g}var d=a(0x56ac793a),c=a(0x9845e38c);class u{matches(e,t){var a;if(!(0,r.QL)(e,o.pH,o.eu))return!1;let n=(null==(a=e.name.split(".").pop())?void 0:a.toLowerCase())||"";return!o.rk.includes(n)||(0,d.Fw)(t)}async tryWiggleUpload(e,t,a){if(!(0,d.Fw)(t))return null;try{return await (0,d.gs)(e,t,a)}catch(t){return c.v.warn(c.u.FILE_UPLOAD,"[Wiggle Upload Failed]",{fileName:e.name,error:t instanceof Error?t.message:String(t)}),null}}async process(e,t,a){let r=await this.tryWiggleUpload(e,t,a);try{let n=await s(e,t.orgUuid,a);if(r&&n.file_size>(0,o.qy)())return{type:"file",data:r};return(null==r?void 0:r.path)&&(n.path=r.path),{type:"attachment",data:n}}catch(e){if(r)return{type:"file",data:r};throw e}}constructor(){this.name="ContentExtractorHandler",this.config={}}}class f{matches(e,t){return e.size>o.gZ}validate(e,t){let a=Math.floor(o.gZ/1e6);return{valid:!1,error:"You may not upload files larger than ".concat(a,"mb.")}}process(){throw Error("FileSizeHandler should never process files")}constructor(){this.name="FileSizeHandler",this.config={}}}async function p(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.yo,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.n6;if("undefined"==typeof document)return e;let r=new Image;if(r.src=URL.createObjectURL(e),await new Promise(e=>{r.onload=e,setTimeout(e,250)}),!r.width||!r.height||"image/png"!==e.type&&r.width<=t&&r.height<=a)return e;let n=r.width/r.height,i=r.width,l=r.height;r.width>t&&(l=(i=t)/n),l>a&&(i=(l=a)*n);let s=document.createElement("canvas");s.style.display="none",document.body.appendChild(s);let d=s.getContext("2d");if(!d||!d.imageSmoothingQuality)return document.body.removeChild(s),e;d.imageSmoothingQuality="high",s.width=i,s.height=l,d.drawImage(r,0,0,i,l);let c=await new Promise(e=>{s.toBlob(t=>e(t),"image/webp",o.hR)});return(document.body.removeChild(s),c)?new File([c],e.name,{type:"image/webp"}):e}var g=a(0x1d4b03596);function m(e){if((0,d.Fw)(e))return(0,d._S)(e);let{orgUuid:t,projectUuid:a}=e;return a?"/api/organizations/".concat(t,"/projects/").concat(a,"/upload"):"/api/".concat(t,"/upload")}class h{matches(e,t){var a;return!!(null==(a=t.modelConfig)?void 0:a.image_in)&&(0,r.QL)(e,o.f9,o.fT)}async preProcess(e,t,a){var r;if(a.aborted)throw Error("Image processing cancelled");return(null==(r=t.featureGates)?void 0:r.use_canvas_resize)?Promise.race([p(e,o.yo,o.n6),new Promise((e,t)=>{a.addEventListener("abort",()=>{t(Error("Image resize cancelled"))})})]):e}async process(e,t,a){if(!this.config.uploadBehavior)throw Error("ImageHandler requires uploadBehavior configuration");let r=this.config.uploadBehavior.getUploadUrl(t);if(!r)throw Error("Failed to get upload URL for image: ".concat(e.name," (").concat(e.size," bytes)"));return{type:"image",data:await (0,g.C)(e,r,a,{handlerName:"Image"})}}constructor(){this.name="ImageHandler",this.config={uploadBehavior:{getUploadUrl:m}}}}var v=a(0xc6857cab);class _{matches(e,t){var a,n;if("1"===v.env.NEXT_PUBLIC_SPREADSHEET_AS_TEXT&&"csv"===(0,r.QC)(e.name))return!1;let i=t.featureGates.wiggleEnabled;if(i){let t=(0,o.qy)();if(e.size>t)return!0}return!!(null!=(n=null==(a=t.featureGates)?void 0:a.ooc_attachments)&&n)&&(0,r.QL)(e,i?o.x4:o.PC)}async process(e,t,a){if(!this.config.uploadBehavior)throw Error("SpreadsheetHandler requires uploadBehavior configuration");let r=this.config.uploadBehavior.getUploadUrl(t);if(!r)throw Error("Failed to get upload URL for out-of-context file: ".concat(e.name," (").concat(e.size," bytes)"));return{type:"file",data:await (0,g.C)(e,r,a,{handlerName:"Out-of-context"})}}constructor(){this.name="OutOfContextFileHandler",this.config={uploadBehavior:{getUploadUrl:m}}}}var w=a(0x5267d157);class y{matches(e,t){return(0,r.QL)(e,o.Ap,o.mw)}async process(e,t,a){var r,n;let o=(null==(r=t.featureGates)?void 0:r.janus_claude_ai)||!1,i=(null==(n=t.modelConfig)?void 0:n.pdf_in)||!1;if(!(o&&i))return{type:"attachment",data:await this.fallbackToTextExtraction(e,t,a)};try{let r=await this.uploadPDFForRasterization(e,t,a);return{type:"file",data:r}}catch(r){if(r instanceof Error&&r.message.includes("document_too_many_pages"))return{type:"attachment",data:await this.fallbackToTextExtraction(e,t,a)};throw r}}async uploadPDFForRasterization(e,t,a){let r=new FormData;r.append("file",e);let n=m(t),o=await fetch(n,{method:"POST",body:r,signal:a});if(!o.ok){var i,l,s,d,c,u;let t=await o.json(),a=(null==(i=t.error)?void 0:i.error_code)||(null==(l=t.error)?void 0:l.errorCode)||(null==(d=t.error)||null==(s=d.details)?void 0:s.error_code)||(null==(u=t.error)||null==(c=u.details)?void 0:c.errorCode);if(400===o.status&&"document_too_many_pages"===a)throw Error("document_too_many_pages");throw new w.o("PDF upload failed: ".concat(o.status),o.status,e.name)}return await o.json()}async fallbackToTextExtraction(e,t,a){return s(e,t.orgUuid,a)}constructor(){this.name="PdfHandler",this.config={}}}var x=a(0x1cae89638);function b(e,t,a){let r=new Blob([e.extracted_content]).size,n=(0,o.qy)();return r>n?(c.v.warn(c.u.FILE_UPLOAD,"[Extracted Content Too Large, Using Out-of-Context]",{fileName:a.name,contentSize:r,maxInContextBytes:n}),{type:"file",data:t}):null}class E{matches(e,t){return!t.featureGates.wiggleEnabled||(0,r.QL)(e,o.xw)}async process(e,t,a){let r=(0,d.Fw)(t),n=null;r&&(n=await (0,d.gs)(e,t,a));try{let o;if(!(0,x.e)(e))try{let t=await (0,x.F)(e),a={file_name:function(e){let t=e.webkitRelativePath;return t&&t.length>0?t:e.name}(e),file_type:e.type,file_size:e.size,extracted_content:t,origin:i.R9.UserUpload,kind:i.XA.File};if(o={...a,extracted_content:l(a.extracted_content),file_name:l(a.file_name),file_type:l(a.file_type)},(null==n?void 0:n.path)&&(o.path=null==n?void 0:n.path),r&&n){let t=b(o,n,e);if(t)return t}return{type:"attachment",data:o}}catch(e){}if(o=await s(e,t.orgUuid,a),(null==n?void 0:n.path)&&(o.path=null==n?void 0:n.path),r&&n){let t=b(o,n,e);if(t)return t}return{type:"attachment",data:o}}catch(t){if(r&&n)return c.v.warn(c.u.FILE_UPLOAD,"[Text Extraction Failed, Using Wiggle]",{fileName:e.name,error:t instanceof Error?t.message:String(t)}),{type:"file",data:n};throw t}}constructor(){this.name="TextAttachmentHandler",this.config={}}}var F=a(0xc6857cab);class C{matches(e,t){var a,n;return!(0,d.Fw)(t)&&(!!((0,r.QL)(e,o.wI)||!(null==(a=t.modelConfig)?void 0:a.image_in)&&(0,r.QL)(e,o.f9))||!!(!(null==(n=t.featureGates)?void 0:n.ooc_attachments)&&(0,r.QL)(e,o.PC))&&("1"!==F.env.NEXT_PUBLIC_SPREADSHEET_AS_TEXT||"csv"!==(0,r.QC)(e.name)))}validate(e,t){var a,n;return!(null==(a=t.featureGates)?void 0:a.ooc_attachments)&&(0,r.QL)(e,o.PC)?{valid:!1,error:"This file type requires 'Code execution and file creation'. Go to Settings > Capabilities to enable."}:!(null==(n=t.modelConfig)?void 0:n.image_in)&&(0,r.QL)(e,o.f9)?{valid:!1,error:"Image uploads are not supported for this model"}:{valid:!1,error:"File type is not supported"}}process(){throw Error("UnsupportedFileHandler should never process files")}constructor(){this.name="UnsupportedFileHandler",this.config={}}}class U{matches(e,t){return t.featureGates.wiggleEnabled}async process(e,t,a){let r=this.config.uploadBehavior.getUploadUrl(t);if(!r)throw Error("Failed to get upload URL for out-of-context file: ".concat(e.name," (").concat(e.size," bytes)"));return{type:"file",data:await (0,g.C)(e,r,a,{handlerName:this.name})}}constructor(){this.name="SimpleUploadToWiggleHandler",this.config={uploadBehavior:{getUploadUrl:m}}}}function T(){let e=new n;return e.registerHandler(new C),e.registerHandler(new f),e.registerHandler(new y),e.registerHandler(new h),e.registerHandler(new u),e.registerHandler(new _),e.registerHandler(new E),e.registerHandler(new U),e}function P(e){return e.filter(e=>!o.hJ.some(t=>t===e.name))}},0x1a3383306:(e,t,a)=>{a.d(t,{Mr:()=>o,R9:()=>r,XA:()=>n});var r=function(e){return e.URLParameter="url_parameter",e.UserUpload="user_upload",e.FirstParty="first_party",e}({}),n=function(e){return e.File="file",e.PastedText="pasted_text",e.Excerpt="excerpt",e.ProgressItem="progress_item",e}({}),o=function(e){return e.Image="image",e.Blob="blob",e.WiggleVM="WiggleVM",e.SanitizedDocument="document",e}({})},0x1cae89638:(e,t,a)=>{a.d(t,{F:()=>i,e:()=>o});var r=a(0x3cdfb8c4),n=a(0x1139502dd);function o(e){let t=(0,r.QC)(e.name),a=n.pH.some(e=>e===t),o=n.eu.some(t=>t===e.type);return a||o}async function i(e){let t=await e.arrayBuffer(),a=function(e){let t=new Uint8Array(e);if(t.length>=4){if(239===t[0]&&187===t[1]&&191===t[2])return"utf-8";if(254===t[0]&&255===t[1]||255===t[0]&&254===t[1])return"utf-16";if(0===t[0]&&0===t[1]&&254===t[2]&&255===t[3]||255===t[0]&&254===t[1]&&0===t[2]&&0===t[3])return"utf-32"}let a=!1,r=Math.min(4e3,t.length),n=0,o=0;for(let e=0;e<r-1;e+=2)0===t[e]&&n++,0===t[e+1]&&o++;let i=r/8;if((n>i||o>i)&&(a=!0),a)return"utf-16";let l=0,s=0;for(let e=0;e<Math.min(1e3,t.length);e++){let a=t[e];a>127&&l++,a>=192&&a<=255&&s++}return s>.3*t.length?"windows-1251":l<.01*t.length?"ascii":"utf-8"}(t);try{return new TextDecoder(a,{fatal:!0}).decode(t)}catch(e){if("utf-8"!==a)return new TextDecoder("utf-8",{fatal:!0}).decode(t)}throw Error("Failed to decode file as plain text")}},0x1d4b03596:(e,t,a)=>{a.d(t,{C:()=>n});var r=a(0x5267d157);async function n(e,t,a,n){let o=(null==n?void 0:n.handlerName)?"".concat(n.handlerName,": "):"",i=new FormData;i.append("file",e);let l=await fetch(t,{method:"POST",body:i,signal:a,credentials:"include"});if(!l.ok)throw new r.o("".concat(o,"Upload failed: ").concat(l.status," ").concat(l.statusText," - ")+"File: ".concat(e.name," (").concat(e.size," bytes, ").concat(e.type,") - ")+"URL: ".concat(t),l.status,e.name);let s=await l.json();if(!s||"object"!=typeof s)throw Error("".concat(o,"Invalid response format for upload: ").concat(e.name));if("type"in s&&"error"===s.type)throw Error("".concat(o,"Upload error: ").concat(s.error.message," - File: ").concat(e.name));if(!("file_kind"in s)||!("file_uuid"in s))throw Error("".concat(o,"Invalid upload response structure for file: ").concat(e.name));return s}},0x1e3604791:(e,t,a)=>{a.d(t,{N:()=>o});var r=a(0xac309a83),n=a(0x78b33fbd);function o(e){let t=(0,n.useLayer)("frontend").get("analysis_tool_experiment_enabled",!1);if((0,r.fS)("rely_on_analysis_flag")){var a;return{value:null==(a=null==e?void 0:e.enabled_artifacts_attachments)||a,source:"flag"}}return{value:(null==e?void 0:e.enabled_artifacts_attachments)||t,source:"experiment"}}}}]);