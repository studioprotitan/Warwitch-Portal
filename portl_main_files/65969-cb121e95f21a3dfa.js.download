try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="1fc588ee-df24-414a-ab9a-c086a78c9867",e._sentryDebugIdIdentifier="sentry-dbid-1fc588ee-df24-414a-ab9a-c086a78c9867")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:anthropic-apps":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[65969],{0xdd00a1e9:(e,n,t)=>{t.d(n,{AM:()=>c,Bi:()=>f,DG:()=>L,FV:()=>S,MS:()=>v,RP:()=>p,Wn:()=>w,cm:()=>b,ms:()=>u,o_:()=>m,q:()=>_,tJ:()=>y});var a=t(0x22102fd88),r=t(0x11cf7113d),i=t(0x19c88845),o=t(0x1a1f6dda6),s=t(0x1fb5bdc42),l=t(0xfc89b4a4);function u(e){let{trigger:n,children:t,unstyledTrigger:r=!1,...i}=e;return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(d,{...i,trigger:r?(0,a.jsx)(s.l9,{asChild:!0,children:n}):(0,a.jsx)(g,{asChild:!0,children:n}),children:t})})}function c(e){let{children:n,open:t,mainButtonText:r,onClickMainButton:l,align:u="end",...c}=e;return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(d,{...c,align:u,trigger:(0,a.jsxs)("div",{className:"flex h-8 whitespace-nowrap",children:[(0,a.jsx)("button",{className:(0,o.A)("font-base-bold !text-xs rounded-l-lg bg-bg-000 h-full flex items-center justify-center px-2 border-y-0.5 border-l-0.5 border-border-200 hover:bg-bg-200",t&&"bg-bg-200"),onClick:l,children:r}),(0,a.jsx)(s.l9,{asChild:!0,children:(0,a.jsx)("button",{className:"bg-bg-000 flex items-center justify-center px-1 hover:bg-bg-200 rounded-r-lg border-0.5 border-border-200",children:(0,a.jsx)(i.CaretDownSmall,{size:16})})})]}),children:n})})}function d(e){var n;let{matchTriggerWidth:t=!1,children:r,open:i,onOpenChange:o,trigger:l,modal:u,...c}=e;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)(s.bL,{open:i,onOpenChange:o,modal:u,children:[l,(0,a.jsx)(s.ZL,{children:(0,a.jsx)(h,{style:t?{width:"var(--radix-dropdown-menu-trigger-width)"}:void 0,sideOffset:null!=(n=c.sideOffset)?n:4,...c,children:r})})]})})}let f=(0,l.forwardRef)((e,n)=>{let{className:t,...r}=e;return(0,a.jsx)(s.lp,{ref:n,className:(0,o.A)("outline-none py-2 px-1.5 -mx-1 -mt-1 mb-1 border-b-0.5 border-border-200",t),...r})});f.displayName="DropdownInputHeader";let h=(0,l.forwardRef)((e,n)=>{let{className:t,...i}=e;return(0,a.jsx)(s.UC,{ref:n,className:(0,o.A)("p-1.5",r.io,r.dk,t),...i})});h.displayName="Content";let g=(0,l.forwardRef)((e,n)=>{let{className:t,...r}=e;return(0,a.jsx)(s.l9,{ref:n,className:(0,o.A)("rounded py-1 px-2 max-w-full whitespace-nowrap text-ellipsis overflow-hidden",t),...r})});g.displayName="Trigger";let p=s.I,v=s.Pb,b=s.ZL,m=(0,l.forwardRef)((e,n)=>{let{className:t,...i}=e;return(0,a.jsx)(s.lp,{ref:n,className:(0,o.A)(r.bS,t),...i})});m.displayName="DropdownLabel";let x=(0,l.forwardRef)((e,n)=>{let{className:t,disabled:i,danger:l,...u}=e;return(0,a.jsx)(s.q7,{ref:n,className:(0,o.A)(r.MQ,i&&r.BK,l&&r.uz,t),...u})});x.displayName="BaseDropdownItem";let y=(0,l.forwardRef)((e,n)=>{let{children:t,icon:r,trailing:i,...o}=e;return r||i?(0,a.jsx)(x,{ref:n,...o,children:(0,a.jsxs)("div",{className:"flex items-center gap-2 w-full font-base group",children:[r,(0,a.jsx)("span",{className:"flex-1 truncate",children:t}),i&&(0,a.jsx)("div",{className:"flex items-center flex-shrink-0 -mr-2",children:i})]})}):(0,a.jsx)(x,{ref:n,...o,children:t})});function _(e){let{className:n,...t}=e;return(0,a.jsx)("div",{className:(0,o.A)("font-base min-h-8 px-2 py-1.5 rounded-lg whitespace-nowrap overflow-hidden text-ellipsis flex justify-between gap-2 items-center",n),...t})}y.displayName="DropdownItem";let w=(0,l.forwardRef)((e,n)=>{let{className:t,...r}=e;return(0,a.jsx)(s.ZP,{ref:n,className:(0,o.A)('font-base min-h-8 px-2 py-1.5 rounded-lg cursor-pointer whitespace-nowrap overflow-hidden text-ellipsis grid grid-cols-[minmax(0,_1fr)_auto] gap-2 items-center outline-none select-none [&[data-highlighted]]:bg-bg-200 [&[data-highlighted]]:text-text-300 [&[data-state="open"]:not([data-highlighted])]:bg-bg-100 [&[data-state="open"]:not([data-highlighted])]:text-text-300',t),...r})});w.displayName="DropdownSubTrigger";let S=(0,l.forwardRef)((e,n)=>{let{className:t,...i}=e;return(0,a.jsx)(s.G5,{ref:n,className:(0,o.A)("p-1.5",r.io,"max-h-[calc(100vh-16px)] overflow-y-auto overflow-x-hidden",t),...i})});S.displayName="DropdownSubContent";let L=(0,l.forwardRef)((e,n)=>{let{className:t,...i}=e;return(0,a.jsx)(s.mB,{ref:n,className:(0,o.A)(r.uR,t),...i})});L.displayName="DropdownSeparator"},0xe0c26d90:(e,n,t)=>{t.d(n,{tn:()=>w,nB:()=>b,rW:()=>m,bo:()=>S,Cq:()=>x,b4:()=>y,yL:()=>_,VX:()=>L});var a=t(0x12c9046cd),r=t(0x14de19ae8),i=t(0x49fac030),o=t(0xac309a83),s=t(0x1b813d90),l=t(0x1bd175d8c),u=t(0x17e725145),c=t(0x20892a038),d=t(0x4d348f95),f=t(0xfc89b4a4),h=t(0x21fe74567),g=t(0x18175ce17),p=t(0xc6857cab);let v="github_success",b=function(){var e;let{callerIdentifier:n,toggleGithubModalOpen:t,fetchImmediately:o=!1,pathname:s,queryString:u,shouldRedirectToDesktopApp:c}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:p}=(0,r.YL)(),b=null==p?void 0:p.uuid,m=x(),[y,_]=(0,f.useState)(o),w=(e=>{let{shouldFetch:n=!1}=e,{activeOrganization:t}=(0,r.YL)(),o=null==t?void 0:t.uuid,s=x();return(0,a.Sk)("/api/organizations/".concat(o,"/sync/github/auth"),{queryKey:[i.Hv,{orgUuid:o}],enabled:!!(n&&t&&s),meta:{noToast:!0}})})({shouldFetch:y}),S=(0,f.useCallback)(async function(){var e,n;let{forceRefetch:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return!y||t?(_(!0),null==(e=(await w.refetch()).data)?void 0:e.is_authenticated):null==(n=w.data)?void 0:n.is_authenticated},[w,y]),{mutate:L}=(0,a.L2)("/api/organizations/".concat(b,"/sync/github/auth/start"),"POST",{enabled:!!(p&&m),onSuccess:e=>{if(function(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(0===n.length)return!1;try{if(!e.startsWith("http://")&&!e.startsWith("https://"))return!1;let t=new URL(e);return"https:"===t.protocol&&n.some(e=>t.hostname===e||t.hostname.endsWith(".".concat(e)))}catch(e){return!1}}(e.redirect_url,["github.com"]))window.location.href=e.redirect_url;else throw Error("Invalid redirect URL received from auth endpoint")}}),A="".concat(v,"=").concat(n).concat(u?"&".concat(u):"");(0,g.FZ)({callerIdentifier:n,successParam:v,handleOpen:()=>{null==t||t(!0)}});let j=(0,d.useSearchParams)(),I=(0,l.V)(),C=(0,f.useRef)(!1),E=(0,d.usePathname)(),k=(0,h.d)({pathname:s||E,searchParams:j,queryString:A,shouldOpenInClaudeApp:I||!!c});return{checkIsGithubAuthenticated:S,initGithubAuth:()=>{if(m){if(I)return void window.open("/settings/connectors?open_in_browser=1&auth_start=github&origin=".concat(k));C.current||(C.current=!0,L({pre_auth_state:{origin:k}}))}},isGithubAuthenticated:null==(e=w.data)?void 0:e.is_authenticated,isLoading:w.isLoading}},m=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,r.YL)(),t=null==n?void 0:n.uuid,o=x(),s=(0,u.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(t,"/sync/github/auth"),"DELETE",{enabled:!!(n&&o),...e,onSuccess:function(){for(var n,a=arguments.length,r=Array(a),o=0;o<a;o++)r[o]=arguments[o];s.invalidateQueries({queryKey:[i.Hv,{orgUuid:t}]}),null==(n=e.onSuccess)||n.call(e,...r)}})},x=()=>{let{data:e}=(0,g.LN)(),n=(0,r.mV)(),t=!!(Array.isArray(e)&&e.find(e=>e.type===s.v8.GITHUB&&e.enabled));return!!(!p.env.NEXT_PUBLIC_DISABLE_GITHUB_INTEGRATION&&(!n||t))},y=()=>{let{activeOrganization:e}=(0,r.YL)(),n=null==e?void 0:e.uuid,t=x();return(0,a.Sk)("/api/organizations/".concat(n,"/sync/github/repos"),{queryKey:[i.jL,{orgUuid:n}],enabled:!!(e&&t),meta:{noToast:!0}})},_=function(){let{skipStatus:e,enabled:n=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,r.YL)(),i=null==t?void 0:t.uuid,s=x(),l=(0,o.fS)("bad_moon_rising_skip_status"),u=null!=e?e:l,c=new URLSearchParams({skip_status:u.toString()}).toString();return(0,a.Sk)("/api/organizations/".concat(i,"/code/repos?").concat(c),{queryKey:["SYNC_GH_REPOS_WITH_STATUS_QUERY_KEY",{orgUuid:i,skipStatus:u}],enabled:!!(t&&i&&s&&n),meta:{noToast:!0}})},w=e=>{var n;let{owner:t,repo:o,branch:s}=e,l=(e=>{let{owner:n,repo:t,branch:o}=e,{activeOrganization:s}=(0,r.YL)(),l=null==s?void 0:s.uuid,u=x(),c=new URLSearchParams({owner:null!=n?n:"",repo:null!=t?t:""}).toString();return(0,a.Sk)("/api/organizations/".concat(l,"/sync/github/repo?").concat(c),{queryKey:[i.yB,{orgUuid:l,owner:n,repo:t}],enabled:!!(n&&t&&!o&&s&&u),meta:{noToast:!0}})})({owner:t,repo:o,branch:s}),u=(e=>{let{owner:n,repo:t,branch:o}=e,{activeOrganization:s}=(0,r.YL)(),l=null==s?void 0:s.uuid,u=x();return(0,a.Sk)("/api/organizations/".concat(l,"/sync/github/repo/").concat(n,"/").concat(t,"/tree/").concat(o),{queryKey:[i.o6,{orgUuid:l,owner:n,repo:t,branch:o}],staleTime:3e5,enabled:!!(n&&t&&o&&s&&u),meta:{noToast:!0}})})({owner:t,repo:o,branch:s||(null==(n=l.data)?void 0:n.default_branch)});return{data:{repo:l.data,tree:u.data},isFetching:l.isFetching||u.isFetching,error:l.error||u.error}},S=e=>{let{repoBranches:n,enabled:t=!0}=e,{activeOrganization:a}=(0,r.YL)(),o=null==a?void 0:a.uuid,s=x(),l=[...n].sort((e,n)=>"".concat(e.repo,":").concat(e.branch).localeCompare("".concat(n.repo,":").concat(n.branch)));return(0,c.useQuery)({queryKey:[i.uh,{orgUuid:o,repoBranches:l}],queryFn:async()=>{let e=await fetch("/api/github/organizations/".concat(o,"/github_batch_branch_status"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({repo_branches:l})});if(!e.ok)throw Error("Failed to fetch branch statuses: ".concat(e.status));return e.json()},enabled:!!(a&&s&&l.length>0&&t),staleTime:5e3,refetchOnWindowFocus:!0})},L=e=>{let n,{repo:t,branch:a,enabled:o=!0}=e,{activeOrganization:s}=(0,r.YL)(),l=null==s?void 0:s.uuid,d=(0,u.useQueryClient)(),f=[i.uh,{orgUuid:l}];for(let[,e]of d.getQueriesData({queryKey:f,exact:!1}))if((null==e?void 0:e.branch_statuses)&&(n=e.branch_statuses.find(e=>e.repo===t&&e.branch===a)))break;let{data:h}=(e=>{let{repo:n,branch:t,enabled:a=!0}=e,{activeOrganization:o}=(0,r.YL)(),s=null==o?void 0:o.uuid,l=x();return(0,c.useQuery)({queryKey:[i.i8,{orgUuid:s,repo:n,branch:t}],queryFn:async()=>{let e=await fetch("/api/github/organizations/".concat(s,"/github_batch_branch_status"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({repo_branches:[{repo:n,branch:t}]})});if(!e.ok)throw Error("Failed to fetch single branch status: ".concat(e.status));return(await e.json()).branch_statuses[0]},enabled:!!(o&&l&&n&&t&&a),staleTime:5e3,refetchOnWindowFocus:!0})})({repo:t,branch:a,enabled:o});return!h&&n?n:h&&!n||h?h:void 0}},0xecd80d84:(e,n,t)=>{t.d(n,{Qp:()=>d,eF:()=>c,w5:()=>u});var a=t(0x12c9046cd),r=t(0x14de19ae8),i=t(0xac309a83),o=t(0x10a2d47e3),s=t(0x17e725145),l=t(0x4d348f95);let u=()=>(0,i.fS)("fiddlehead"),c=()=>{let{activeOrganization:e}=(0,r.YL)(),n=null==e?void 0:e.uuid,t=u(),i=(0,o.wc)(),{data:s,isFetched:c}=(0,a.Sk)("/api/oauth/organizations/".concat(n,"/oauth_tokens"),{enabled:!!(n&&t),staleTime:3e5}),d=(0,l.useSearchParams)().get("debug_fiddlehead_auth_override"),f=i[o.me],h=f&&(null==s?void 0:s.some(e=>e.application_name===f));return{isAuthenticated:null!==d?"1"===d:h,isFetched:c,initAuth:()=>{window.open(i[o.vf],"_blank")}}},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:n}=(0,r.YL)(),t=null==n?void 0:n.uuid,i=u(),o=(0,s.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(t,"/fiddlehead/disconnect_and_delete_all"),"POST",{enabled:!!(n&&i),...e,onSuccess:function(){for(var n,a=arguments.length,r=Array(a),i=0;i<a;i++)r[i]=arguments[i];o.invalidateQueries({queryKey:["/api/oauth/organizations/".concat(t,"/oauth_tokens")]}),null==(n=e.onSuccess)||n.call(e,...r)}})}},0xfb91a209:(e,n,t)=>{t.d(n,{Q:()=>l,t:()=>u});var a=t(0x22102fd88),r=t(0x286b4261),i=t.n(r),o=t(0xfc89b4a4);let s=(0,o.createContext)({isOpen:!1,dropdownToOpen:void 0,openModal:i(),closeModal:i(),clearCallerIdentifier:i()}),l=e=>{let{children:n}=e,[t,r]=(0,o.useState)(!1),i=(0,o.useRef)(void 0),[l,u]=(0,o.useState)(void 0);return(0,a.jsx)(s.Provider,{value:{isOpen:t,openModal:e=>{r(!0),i.current=e},closeModal:()=>{r(!1),u(i.current)},dropdownToOpen:l,clearCallerIdentifier:()=>{u(void 0)}},children:n})},u=()=>(0,o.useContext)(s)},0x1065e58a2:(e,n,t)=>{t.d(n,{AI:()=>u,I5:()=>c,n0:()=>l,qp:()=>d,so:()=>f});var a=t(0x12c9046cd),r=t(0x14de19ae8),i=t(0x49fac030);t(0x1b813d90);var o=t(0x17e725145);t(0xfc89b4a4);var s=t(0x18175ce17);let l=e=>{let{uri:n}=e,{data:t,isLoading:o}=(e=>{let{documentId:n}=e,{account:t,activeOrganization:o}=(0,r.YL)(),s=null==t?void 0:t.uuid,l=null==o?void 0:o.uuid,c=u();return(0,a.Sk)("/api/organizations/".concat(l,"/sync/mcp/outline/document/").concat(n),{queryKey:[i.hq,{accountUUID:s,orgUuid:l,documentId:n}],enabled:c})})({documentId:n});return{title:null==t?void 0:t.title,isLoading:o}},u=()=>{let{data:e}=(0,s.LN)();return!1},c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:n,activeOrganization:t}=(0,r.YL)(),o=null==t?void 0:t.uuid,s=u(),{data:l,refetch:c}=(0,a.Sk)("/api/organizations/".concat(o,"/sync/mcp/outline/auth"),{queryKey:[i.iP,{accountUUID:null==n?void 0:n.uuid,orgUuid:o}],enabled:!!(t&&s),staleTime:5e3}),{mutate:d,isPending:f}=(0,a.L2)("/api/organizations/".concat(o,"/sync/mcp/outline/auth/start"),"POST",{enabled:!!(t&&s),...e,onSuccess:function(){for(var n,t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];null==(n=e.onSuccess)||n.call(e,...a)}});return{isOutlineAuthenticated:!!(null==l?void 0:l.is_authenticated),refetch:c,initOutlineAuth:d,isLoadingOutlineAuthInit:f}},d=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:n,activeOrganization:t}=(0,r.YL)(),s=null==n?void 0:n.uuid,l=null==t?void 0:t.uuid,c=u(),d=(0,o.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(l,"/sync/mcp/outline/auth"),"DELETE",{enabled:!!(t&&c),...e,onSuccess:function(){for(var n,t=arguments.length,a=Array(t),r=0;r<t;r++)a[r]=arguments[r];d.invalidateQueries({queryKey:[i.iP,{accountUUID:s,orgUuid:l}]}),null==(n=e.onSuccess)||n.call(e,...a)}})},f=()=>{let e=encodeURIComponent(window.location.href);window.location.href="/settings/connectors?redirect_url=".concat(e,"&open_outline_auth=true")}},0x11c7a82c2:(e,n,t)=>{t.d(n,{R:()=>a.R});var a=t(0x1c4b61688)},0x1334f6ecc:(e,n,t)=>{t.d(n,{$f:()=>z,Gk:()=>C,K6:()=>P,L5:()=>q,LP:()=>j,U5:()=>D,cI:()=>E,cj:()=>k,ef:()=>F,fb:()=>O,kJ:()=>I,qL:()=>M,vT:()=>Y,y:()=>T,yy:()=>L,zF:()=>R,zH:()=>N});var a=t(0x17aa9d8d7),r=t(0x12c9046cd),i=t(0x14de19ae8),o=t(0x139b5e710),s=t(0x49fac030),l=t(0xac309a83),u=t(0x1b813d90),c=t(0x1bd175d8c),d=t(0x78b33fbd),f=t(0x17e725145),h=t(0x4d348f95),g=t(0xfc89b4a4),p=t(0x1ab0d1ca1),v=t(0x87b1176c),b=t(0xfb91a209),m=t(0x187ab14f6),x=t(0x21fe74567),y=t(0x31c535e9),_=t(0x18175ce17),w=t(0xc6857cab);let S="gdrive_success",L=()=>{let e=(0,i.mV)(),{data:n}=(0,_.LN)(),t=(0,_.kO)(),a=(0,_.qi)(u.v8.GDRIVE),r=!1;if(t){var o;let e=Array.isArray(n)?n.find(e=>e.type===u.v8.MCP_RESOURCES):null;(null==a?void 0:a.uuid)&&(null==e||null==(o=e.config)?void 0:o.servers)&&(r=!!e.config.servers[a.uuid])}else r=!!(Array.isArray(n)&&n.find(e=>e.type===u.v8.GDRIVE&&e.enabled));return!e||r},A=()=>{let e=(0,l.fS)("kingfisher_enabled"),n=(0,d.useLayer)("trials_freemium").get("free_integrations",!1);return e||n},j=()=>{let e=L(),n=A();return!!(!w.env.NEXT_PUBLIC_DISABLE_GDRIVE_INTEGRATION&&n&&e)},I=()=>{let{account:e,activeOrganization:n}=(0,i.YL)(),t=null==n?void 0:n.uuid,a=j(),{data:o,isFetched:l}=(0,r.Sk)("/api/organizations/".concat(t,"/sync/mcp/drive/auth"),{queryKey:[s.jR,{accountUUID:null==e?void 0:e.uuid,orgUuid:t}],enabled:a,staleTime:3e5});return{isAuthenticated:a&&!!(null==o?void 0:o.is_authenticated),isFetched:l}},C=()=>{let e=A(),n=(0,_.kO)(),t=(0,_.dJ)(u.v8.GDRIVE),a=(0,_.hm)(u.v8.GDRIVE);return!!e&&(n?t:a)},E=function(){let{callerIdentifier:e,handleAuthSuccess:n,pathname:t,queryString:a}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},l=(0,_.kO)(),{isAuthenticated:d,startAuth:v,isFetched:m}=(0,_.ob)(u.v8.GDRIVE,{callerIdentifier:e,handleAuthSuccess:n,pathname:t,queryString:a}),{isAuthenticated:y,isFetched:w}=I(),{addSuccess:L}=(0,o.Yf)(),A=(0,p.A)(),{dropdownToOpen:C,clearCallerIdentifier:E}=(0,b.t)(),k=function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];null==n||n(e),L(A.formatMessage({defaultMessage:"Connected to Google Drive",id:"ij6u4TNsGF"}))},D=(e=>{let{callerIdentifier:n,pathname:t,queryString:a}=e,o=(0,h.usePathname)(),{account:l,activeOrganization:u}=(0,i.YL)(),d=null==l?void 0:l.uuid,p=null==u?void 0:u.uuid,v=j(),b=(0,f.useQueryClient)(),m=(0,c.V)(),y=(0,h.useSearchParams)(),{mutate:_}=(0,r.L2)("/api/organizations/".concat(p,"/sync/mcp/drive/auth/start"),"POST",{enabled:v,onSuccess:e=>{window.location.href=e.redirect_url}}),w=(0,g.useRef)(!1);return()=>{if(!v)return;let e="".concat(S,"=").concat(n).concat(a?"&".concat(a):""),r=(0,x.d)({pathname:t||o,searchParams:y,queryString:e,shouldOpenInClaudeApp:m});if(b.invalidateQueries({queryKey:[s.jR,{accountUUID:d,orgUuid:p}]}),m)return void window.open("/settings/connectors?open_in_browser=1&auth_start=gdrive&origin=".concat(r));w.current||(w.current=!0,_({pre_auth_state:{origin:r},redirect_uri:new URL("/connect/mcp/drive/callback",window.location.origin).toString()}))}})({callerIdentifier:e,pathname:t,queryString:a});return((0,_.FZ)({callerIdentifier:e,successParam:S,handleOpen:k}),(0,g.useEffect)(()=>{e&&C===e&&(null==n||n(!0),E())},[C,n,e,E]),l)?{isDriveAuthenticated:d,initDriveAuth:v,handleDriveTrigger:k,isFetched:m}:{isDriveAuthenticated:y,initDriveAuth:D,handleDriveTrigger:k,isFetched:w}},k=()=>{let e=(0,_.kO)(),n=(0,_.qi)(u.v8.GDRIVE);return{serverId:null==n?void 0:n.uuid,isConnected:null==n?void 0:n.isConnected,isEnabled:e}},D=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:n,activeOrganization:t}=(0,i.YL)(),a=null==n?void 0:n.uuid,o=null==t?void 0:t.uuid,l=j(),u=(0,f.useQueryClient)(),{mutate:c}=(0,v.ih)();return(0,r.L2)("/api/organizations/".concat(o,"/sync/mcp/drive/auth"),"DELETE",{enabled:!!(t&&l),...e,onSuccess:function(){for(var n,t=arguments.length,r=Array(t),i=0;i<t;i++)r[i]=arguments[i];u.invalidateQueries({queryKey:[s.jR,{accountUUID:a,orgUuid:o}]}),c({}),null==(n=e.onSuccess)||n.call(e,...r)}})},T=e=>{let{documentId:n}=e,{account:t,activeOrganization:a}=(0,i.YL)(),o=null==t?void 0:t.uuid,l=null==a?void 0:a.uuid,u=j(),c=(0,f.useQueryClient)(),d=(0,r.Sk)("/api/organizations/".concat(l,"/sync/mcp/drive/document/").concat(n,"?include_content=false"),{queryKey:[s.QB,{accountUUID:o,orgUuid:l,documentId:n}],enabled:u,meta:{noToast:!0}}),h=d.isError;return(0,g.useEffect)(()=>{h&&c.invalidateQueries({queryKey:[s.jR,{accountUUID:o,orgUuid:l}]})},[c,h,o,l]),d};function R(e){let{uri:n}=e,{data:t,isLoading:a}=T({documentId:n});return{title:null==t?void 0:t.title,isLoading:a}}let M=e=>{let{account:n,activeOrganization:t}=(0,i.YL)(),a=null==n?void 0:n.uuid,o=null==t?void 0:t.uuid,l=j(),u=(0,g.useMemo)(()=>e.map(e=>"/api/organizations/".concat(o,"/sync/mcp/drive/document/").concat(e)),[e,o]),c=(0,g.useMemo)(()=>({queryKey:e.map(e=>[s.qM,{accountUUID:a,orgUuid:o,documentId:e}]),enabled:l,meta:{noToast:!0}}),[e,a,o,l]);return(0,r._i)(u,c)},N=e=>{let{account:n,activeOrganization:t}=(0,i.YL)(),a=null==n?void 0:n.uuid,o=null==t?void 0:t.uuid,l=j(),u=(0,m.bI)(),{data:c,isSuccess:d,isLoading:f}=(0,r.Sk)("/api/organizations/".concat(o,"/sync/mcp/drive/recents"),{queryKey:[s.zu,{accountUUID:a,orgUuid:o}],enabled:e&&l,meta:{noToast:!0}});return(0,g.useEffect)(()=>{if(d&&c){let e=c.map(e=>{let{uri:n,title:t}=e;return{uri:n,title:t}});(0,m.Ac)(e)}},[d,c]),{recentDriveDocs:d?c:u,isLoading:f}},O=()=>{let e=A(),n=(0,l.fS)("apps_use_bananagrams"),t=(0,d.useLayer)("trials_freemium").get("free_integrations",!1);return e&&n||t},P=()=>{let e=j(),n=O();return e&&n&&!w.env.NEXT_PUBLIC_DISABLE_GDRIVE_INTEGRATION},z=e=>{var n;let t=P(),{account:a}=(0,i.YL)(),r=(0,l.fS)("claude_ai_sticky_project_settings"),o=(0,y.vP)("enabled_bananagrams");return!!t&&(r?!!o:e?!!(null==e||null==(n=e.conversationSettings)?void 0:n.enabled_bananagrams):!!(null==a?void 0:a.settings.enabled_bananagrams))},q=()=>(0,l.fS)("rag_prototype"),Y=()=>{let e=P(),n=(0,i.mV)(),{data:t}=(0,_.LN)(),{account:a}=(0,i.YL)(),r=q(),o=(0,_.kO)(),s=(0,_.qi)(u.v8.GDRIVE);if(!e||!r)return!1;if(n)if(!o)return!!(Array.isArray(t)&&t.find(e=>{var n;return e.type===u.v8.GDRIVE&&e.enabled&&(null==(n=e.config)?void 0:n.allow_indexing)}));else{var l;let e=Array.isArray(t)?t.find(e=>e.type===u.v8.MCP_RESOURCES):null;if((null==s?void 0:s.uuid)&&(null==e||null==(l=e.config)?void 0:l.servers)){let n=e.config.servers[s.uuid];return!!(null==n?void 0:n.allow_indexing)}return!1}return!!(null==a?void 0:a.settings.enabled_gdrive_indexing)},F=()=>{let{account:e}=(0,i.YL)(),{mutate:n}=(0,a.yJ)(),{mutate:t}=(0,v.Bg)();return{toggleDriveSearchAndIndexingEnabled:a=>{var r;let{indexingEnabled:i,searchEnabled:o,dismissBanner:s}=a,l=s||!!i;i&&t({}),n({...void 0!==i?{enabled_gdrive_indexing:i}:null,...void 0!==o||!0===i?{enabled_bananagrams:null!=i?i:o}:null,...l?{dismissed_claudeai_banners:[...(null==e||null==(r=e.settings)?void 0:r.dismissed_claudeai_banners)||[],{banner_id:"drive_indexing_enablement_2/11_1",dismissed_at:new Date().toISOString()}]}:null})}}}},0x180e403f7:(e,n,t)=>{t.d(n,{m:()=>m});var a=t(0x22102fd88),r=t(0x19273021e),i=t(0x14de19ae8),o=t(0x139b5e710),s=t(0x11c7a82c2),l=t(0x1b813d90),u=t(0x10a2d47e3),c=t(0xfc89b4a4),d=t(0x1ab0d1ca1),f=t(0x1d302b010),h=t(0x1334f6ecc),g=t(0xecd80d84),p=t(0xe0c26d90),v=(t(0x1065e58a2),t(0x18175ce17)),b=t(0x20095e84e);function m(e){let{type:n,server:t,onClose:r,onDisconnect:i}=e;if(t)return(0,a.jsx)(w,{server:t,onClose:r,onDisconnect:i});switch(n){case l.v8.GITHUB:return(0,a.jsx)(x,{onClose:r,onDisconnect:i});case l.v8.GDRIVE:return(0,a.jsx)(y,{onClose:r,onDisconnect:i});case l.v8.OUTLINE:return;case l.v8.FIDDLEHEAD:return(0,a.jsx)(S,{onClose:r,onDisconnect:i});case l.v8.CUTTLEFISH:return(0,a.jsx)(L,{onClose:r,onDisconnect:i});default:return(0,a.jsx)(_,{type:n,onClose:r,onDisconnect:i})}}function x(e){let{onClose:n,onDisconnect:t}=e,{mutate:r,isPending:i}=(0,p.rW)(),o=(0,c.useCallback)(()=>{r(),null==t||t()},[r,t]);return(0,a.jsx)(A,{name:"GitHub",onDisconnect:o,disconnecting:i,onClose:n})}function y(e){let{onClose:n,onDisconnect:t}=e,{mutate:r,isPending:i}=(0,h.U5)(),o=(0,d.A)(),s=(0,c.useCallback)(()=>{r(),null==t||t()},[r,t]);return(0,a.jsx)(A,{name:"Google Drive",onDisconnect:s,disconnecting:i,onClose:n,modalMessageOverride:o.formatMessage({defaultMessage:"You won’t be able to continue any previous chats that reference content from Google Docs.",id:"Zi7eVRnAwf"})})}function _(e){let{type:n,onClose:t,onDisconnect:r}=e,{disconnect:i}=(0,v.ob)(n),o=(0,c.useCallback)(()=>{i(),null==r||r()},[i,r]);return(0,a.jsx)(A,{name:(0,b.xI)(n),onDisconnect:o,disconnecting:!1,onClose:t})}function w(e){let{server:n,onClose:t,onDisconnect:r}=e,s=(0,d.A)(),{activeOrganization:l}=(0,i.YL)(),{addError:u}=(0,o.Yf)(),{mutate:h,isPending:g}=(0,f.W3)((null==l?void 0:l.uuid)||"",n.uuid,{onError:e=>{u(s.formatMessage({defaultMessage:"Failed to disconnect from server",id:"L488a5jdgF"}),{error:e,messageForLogging:"Failed to disconnect from server"})}}),p=(0,c.useCallback)(()=>{h(),null==r||r()},[h,r]);return(0,a.jsx)(A,{name:n.name,onDisconnect:p,disconnecting:g,onClose:t})}function S(e){let{onClose:n,onDisconnect:t}=e,{mutate:r,isPending:i}=(0,g.Qp)(),o=(0,b.ak)(),s=(0,u.wc)(),d=s[u.BU],f=s[u.jT],h=s[u.fh],p=(0,c.useCallback)(()=>{r(),null==t||t()},[r,t]);return(0,a.jsx)(A,{name:o(l.v8.FIDDLEHEAD),onDisconnect:p,disconnecting:i,onClose:n,modalMessageOverride:d,modalTitleOverride:f,modalButtonOverride:h})}function L(e){let{onClose:n,onDisconnect:t}=e,{mutate:i,isPending:o}=(0,r.fH)(),s=(0,b.ak)(),u=(0,c.useCallback)(()=>{i(),null==t||t()},[i,t]);return(0,a.jsx)(A,{name:s(l.v8.CUTTLEFISH),onDisconnect:u,disconnecting:o,onClose:n})}function A(e){let{name:n,onDisconnect:t,disconnecting:r,onClose:i,modalMessageOverride:o,modalTitleOverride:l,modalButtonOverride:u}=e,c=(0,d.A)(),f=null!=l?l:c.formatMessage({defaultMessage:"Disconnect {integrationName}?",id:"MUrNVj88RO"},{integrationName:n}),h=null!=u?u:c.formatMessage({defaultMessage:"Disconnect",id:"qj1uhzynub"}),g=null!=o?o:c.formatMessage({defaultMessage:"You can still continue previous chats that reference {integrationName} content. However, Claude won’t be able to access new content or perform new tasks.",id:"tlmLidjA7e"},{integrationName:n});return(0,a.jsx)(s.R,{isOpen:!0,onClose:i,title:f,onConfirm:()=>{t(),i()},confirmText:h,variant:"danger",autoFocus:!1,message:g,size:"md",isLoading:r})}},0x19273021e:(e,n,t)=>{t.d(n,{EX:()=>_,Jh:()=>w,KN:()=>m,Ws:()=>p,bH:()=>S,f0:()=>v,fH:()=>L,v5:()=>b,z5:()=>y});var a=t(0x22102fd88),r=t(0xf32c56dd),i=t(0x12c9046cd),o=t(0xa5acf583),s=t(0x14de19ae8),l=t(0x1016c6ed2),u=t(0x49fac030),c=t(0xac309a83),d=t(0x10a2d47e3),f=t(0x17e725145),h=t(0xc3731bfa),g=t(0x38e6572);let p="This application requires one of these plans",v="This application is not authorized",b={"user:profile":{messageId:"oauth.scope.user.profile",description:(0,a.jsx)(g.A,{defaultMessage:"Access your Anthropic profile information",id:"EvXAQK/bGO"})},"user:inference":{messageId:"oauth.scope.user.inference",description:(0,a.jsx)(g.A,{defaultMessage:"Contribute to your Claude subscription usage",id:"Srbd8zdRfZ"})},"user:chat:read":{messageId:"oauth.scope.user.chat.read",description:(0,a.jsx)(g.A,{defaultMessage:"Read your conversations",id:"tP+tU2ijW1"})},"user:chat":{messageId:"oauth.scope.chat",description:(0,a.jsx)(g.A,{defaultMessage:"Create, continue, and delete your conversations",id:"ABf9wj7LhM"})},"user:file_upload":{messageId:"oauth.scope.user.file_upload",description:(0,a.jsx)(g.A,{defaultMessage:"Upload files on your behalf",id:"JIdIkswZw2"})},"user:sessions:claude_code":{messageId:"oauth.scope.user.sessions.claude_code",description:(0,a.jsx)(g.A,{defaultMessage:"Access your Claude Code sessions",id:"39jWfLQ2ze"})},"user:mcp_servers":{messageId:"oauth.scope.user.mcp_servers",description:(0,a.jsx)(g.A,{defaultMessage:"Use and manage your connectors",id:"XUNFVA5Hbv"})},"org:profile":{messageId:"oauth.scope.org.profile",description:(0,a.jsx)(g.A,{defaultMessage:"Access profile information for all members in your organization",id:"5CqC2vx+3K"})},"org:inference":{messageId:"oauth.scope.org.inference",description:(0,a.jsx)(g.A,{defaultMessage:"Make API calls on behalf of your organization",id:"l/AJQVR0UT"})},"org:create_api_key":{messageId:"oauth.scope.org.create_api_key",description:(0,a.jsx)(g.A,{defaultMessage:"Generate API keys on your behalf",id:"Li8bwfrwx/"})}};function m(e){let{activeOrganization:n}=(0,s.YL)();return(0,i.Sk)("/v1/oauth/".concat(null==n?void 0:n.uuid,"/authorize?client_id=").concat(e),{enabled:!!e})}function x(e,n){return new Promise((t,a)=>{if("undefined"==typeof chrome||!chrome.runtime)return void a(Error("Chrome extension API not available"));chrome.runtime.sendMessage(e,{type:"oauth_redirect",redirect_uri:n},()=>{chrome.runtime.lastError?a(Error(chrome.runtime.lastError.message)):t()})})}function y(e,n,t){let{activeOrganization:a}=(0,s.YL)(),{claudeBrowserExtensionClientId:u,claudeBrowserExtensionId:d,antOnlyClaudeBrowserExtensionId:f}=(0,o._r)(),{track:h}=(0,r.st)(),g=(0,c.fS)("crochet_eligible_for_ant_only_build");return(0,i.L2)("/v1/oauth/".concat(null==a?void 0:a.uuid,"/authorize"),"POST",{meta:{noToast:e=>{var n,a;return!!(null==t?void 0:t.suppressToast)&&((null==(n=e.message)?void 0:n.includes(p))||(null==(a=e.message)?void 0:a.includes(v)))}},onSuccess:async(n,t)=>{if(h({event_key:"oauth.authorize.success",client_id:t.client_id,client_name:e}),n.redirect_uri)if(t.client_id===u)if("undefined"!=typeof chrome&&chrome.runtime)if(g&&f)try{await x(f,n.redirect_uri)}catch(e){await x(d,n.redirect_uri)}else await x(d,n.redirect_uri);else throw Error("Chrome extension API not available. Ensure there is an installed extension connectable from this domain.");else window.location.assign(n.redirect_uri)},onError:(t,a)=>{let r="unknown";t instanceof l.LG&&(r=t.type),h({event_key:"oauth.authorize.failure",client_id:a.client_id,client_name:e,error_type:r}),n&&n(t)}})}function _(e){let{activeOrganization:n}=(0,s.YL)(),t=null==n?void 0:n.uuid;return(0,i.Sk)("/api/account/tengu_waitlist/".concat(t),{queryKey:[u.Af,t],enabled:!!t,...e})}function w(e){let{activeOrganization:n}=(0,s.YL)(),t=null==n?void 0:n.uuid,a="/api/oauth/organizations/".concat(t,"/oauth_tokens");if(e){let n=new URLSearchParams({application_slug:e});a="".concat(a,"?").concat(n.toString())}return(0,i.Sk)(a,{enabled:!!t})}function S(){let{activeOrganization:e}=(0,s.YL)(),n=null==e?void 0:e.uuid;return(0,i.L2)(e=>"/api/oauth/organizations/".concat(n,"/oauth_tokens/").concat(e,"/revoke"),"POST",{enabled:!!n})}function L(){let{activeOrganization:e}=(0,s.YL)(),n=null==e?void 0:e.uuid,{data:t,refetch:a}=w((0,d.wc)()[d.j$]||""),r=(0,f.useQueryClient)(),i=S(),o=(0,h.useMutation)({mutationFn:async()=>{if(!t||0===t.length)return;let e=[];for(let n of t)try{await i.mutateAsync(n.id)}catch(n){e.push(n)}if(e.length===t.length)throw Error("Failed to revoke any Cuttlefish tokens")},onSuccess:()=>{r.invalidateQueries({queryKey:["/api/oauth/organizations/".concat(n,"/oauth_tokens")]}),a()}});return{mutate:o.mutate,isPending:o.isPending||i.isPending}}},0x1b03847fb:(e,n,t)=>{t.d(n,{AM:()=>a.AM,Bi:()=>a.Bi,DG:()=>a.DG,FV:()=>a.FV,MS:()=>a.MS,RP:()=>a.RP,Wn:()=>a.Wn,cm:()=>a.cm,ms:()=>a.ms,o_:()=>a.o_,q:()=>a.q,tJ:()=>a.tJ});var a=t(0xdd00a1e9)},0x20095e84e:(e,n,t)=>{t.d(n,{ak:()=>s,cO:()=>i,xI:()=>o});var a=t(0x1b813d90),r=t(0x10a2d47e3);let i="settings",o=e=>a.sb[e]||e,s=()=>{let e=(0,r.wc)();return n=>n===a.v8.FIDDLEHEAD&&e[r.Wj]?e[r.Wj]:n===a.v8.CUTTLEFISH&&e[r.in]?e[r.in]:a.sb[n]||n}}}]);