try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="23a7984a-20e3-4db0-9c5e-e7b5b98c7855",e._sentryDebugIdIdentifier="sentry-dbid-23a7984a-20e3-4db0-9c5e-e7b5b98c7855")}catch(e){}{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{};e._sentryModuleMetadata=e._sentryModuleMetadata||{},e._sentryModuleMetadata[new e.Error().stack]=Object.assign({},e._sentryModuleMetadata[new e.Error().stack],{"_sentryBundlerPluginAppKey:anthropic-apps":!0})}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[58936],{0x2662014e:(e,n,t)=>{t.d(n,{c:()=>r});let r=(0,t(0x394ef833).v)((e,n)=>({currentRequest:null,setCurrentRequest:n=>e({currentRequest:n}),clearCurrentRequest:()=>{e({currentRequest:null})},acceptElicitation:t=>{let r=n().currentRequest;r&&(r.resolve({action:"accept",content:t}),e({currentRequest:null}))},declineElicitation:()=>{let t=n().currentRequest;t&&(t.resolve({action:"decline"}),e({currentRequest:null}))},cancelElicitation:()=>{let t=n().currentRequest;t&&(t.resolve({action:"cancel"}),e({currentRequest:null}))}}))},0x62983db6:(e,n,t)=>{t.d(n,{F:()=>d,R:()=>u});var r=t(0x139b5e710),i=t(0x18393fe29),o=t(0x10e01d04d),a=t(0xfc89b4a4),s=t(0xe824fb1c),c=t(0x2662014e),l=t(0xc6857cab);function d(){return!!(0,i.yz)()&&!l.env.DONT_USE_ELICITATION_MCP}function u(){let e=d(),{clients:n,clientMetadata:t}=(0,s.Ak)(),{setCurrentRequest:i}=(0,c.c)(),{addError:l}=(0,r.Yf)();(0,a.useEffect)(()=>{if(e)return n.forEach(e=>{let n=t.get(e);e.setRequestHandler(o.$9,async e=>new Promise((t,r)=>{i({id:"".concat(Date.now(),"-").concat(Math.random()),serverName:n.name,iconType:n.iconType,iconSrc:n.iconSrc,request:e,resolve:t,reject:r})}))}),()=>{e&&n.forEach(e=>{e.removeRequestHandler(o.$9.shape.method.value)})}},[e,n,t,i,l])}},0x6940a678:(e,n,t)=>{t.d(n,{ConnectorsStore:()=>eo});var r=t(0x14c0dfde7),i=t(0x21edecce6),o=t(0x1e746fe9e),a=t(0x156c4e43b);function s(){let e=new o._({name:"Elicitation Test",version:"1.0.0"});return e.tool("elicit_confirmation","Elicitation confirmation tool",{style:a.k5(["bool","enum","no-field"])},async n=>{let{style:t}=n,r=await e.server.elicitInput({message:"Do you confirm you want to proceed?",requestedSchema:{type:"object",properties:"no-field"===t?{}:{confirm:"enum"===t?{title:"Confirm",type:"string",enum:["yes","no"],enumNames:["Yes, I confirm","No, cancel"]}:{title:"Confirm",type:"boolean",description:"Please confirm your action"}},required:["confirm"]}});return{content:[{type:"text",text:"Elicitation result: ".concat(JSON.stringify(r,null,2))}]}}),e.tool("elicit_inputs","Elicitation test tool",{},async(n,t)=>{let r=await e.server.elicitInput({message:"Please provide inputs for the following fields:",requestedSchema:{type:"object",properties:{name:{title:"Full Name",type:"string",description:"Your full, legal name"},check:{title:"Agree to terms",type:"boolean",description:"A boolean check"},color:{title:"Favorite Color",type:"string",description:"Favorite color (open text)",default:"blue"},email:{title:"Email Address",type:"string",format:"email",description:"Your email address (will be verified, and never shared with anyone else)"},homepage:{type:"string",format:"uri",description:"Homepage / personal site"},birthdate:{title:"Birthdate",type:"string",format:"date",description:"Your date of birth (will never be shared with anyone else)"},integer:{title:"Favorite Integer",type:"integer",description:"Your favorite integer (do not give us your phone number, pin, or other sensitive info)",minimum:1,maximum:100,default:42},number:{title:"Favorite Number",type:"number",description:"Favorite number (there are no wrong answers)",minimum:0,maximum:1e3,default:3.14},petType:{title:"Pet type",type:"string",enum:["cats","dogs","birds","fish","reptiles"],enumNames:["Cats","Dogs","Birds","Fish","Reptiles"],default:"dogs",description:"Your favorite pet type"}},required:["name"]}},{relatedRequestId:t.requestId,timeout:1e8});return{content:[{type:"text",text:"Elicitation result: ".concat(JSON.stringify(r,null,2))}]}}),e.tool("write_poem","Poem writing tool",{},async()=>{let n=await e.server.elicitInput({message:"Please provide inputs for the following fields:",requestedSchema:{type:"object",properties:{subject:{type:"string",title:"Subject",description:"Subject of the poem",enum:["Nature","Love","Adventure","Friendship","Mystery","Fantasy","Humor","Inspiration","Life","Death"]}},required:["subject"]}});if("accept"!==n.action||!(null==n?void 0:n.data))throw Error("Elicitation was not accepted or no data provided");let{subject:t}=n.data;return{content:[{type:"text",text:"TODO: write a poem about ".concat(t)}]}}),e}var c=t(0xf32c56dd),l=t(0x12c9046cd),d=t(0x14de19ae8),u=t(0x139b5e710),p=t(0x10e01d04d),m=t(0xfc89b4a4),h=t(0xe824fb1c);function f(){let e=new o._({name:"Demo",version:"1.0.0"});return e.tool("add",{a:a.ai(),b:a.ai()},e=>{let{a:n,b:t}=e;return{content:[{type:"text",text:String(n+t)}]}}),e.tool("greet_person",{name:a.Yj(),greeting:a.Yj()},e=>{let{name:n,greeting:t}=e;return{content:[{type:"text",text:"Message sent to ".concat(n,": ").concat(t," ").concat(n,"!")}]}}),e.registerTool("draft_email",{description:"Draft an email. IMPORTANT: Only include recipient email if the user has explicitly provided it. Never make up or guess email addresses.",inputSchema:{recipientName:a.Yj().optional().describe("Recipient name - only include if explicitly provided by user"),recipientEmail:a.Yj().email().optional().describe("Recipient email address - only include if explicitly provided by user, never fabricate"),subject:a.Yj().describe("Email subject")}},async(n,t)=>{let{recipientName:r,recipientEmail:i,subject:o}=n,a=await e.server.elicitInput({message:"Please validate this email draft",requestedSchema:{type:"object",properties:{recipientName:{type:"string",description:"Recipient name",default:r},recipientEmail:{type:"string",format:"email",description:"Recipient email",default:i},subject:{type:"string",description:"Subject",default:o},body:{type:"string",description:"Body",default:"Ad Consectetur Et\n\nLorem Ipsum enim lorem quis ad dolor sed incididunt veniam sit et incididunt. Et dolor ad amet sed dolor minim ipsum dolor aliqua et. Adipiscing ad dolore eiusmod lorem minim ipsum sed dolore elit consectetur. Et sit labore lorem incididunt labore nostrud enim enim. Dolore ipsum ipsum dolor elit do consectetur labore quis elit ipsum ad. Ad quis labore eiusmod sit ipsum elit minim labore sit consectetur eiusmod ut quis sit. Elit minim adipiscing do magna consectetur minim sed aliqua nostrud minim magna quis incididunt. Do enim magna et dolor ut amet ut.\n\nAmet elit sed dolore magna ut sed do aliqua ipsum nostrud et aliqua veniam. Sed incididunt tempor quis ad magna do do. Consectetur incididunt et incididunt dolore labore labore ad enim lorem ipsum et. Magna dolore do ipsum elit do lorem et lorem minim et ad sed. Adipiscing labore sed quis incididunt dolor dolor quis sit sed ipsum amet minim. Sed ad ut incididunt minim adipiscing dolor eiusmod ad nostrud. Amet ut sit et magna veniam dolor enim elit sed ipsum aliqua. Incididunt ipsum veniam veniam amet amet quis sit ut.\n\nEnim incididunt eiusmod dolor magna incididunt dolor quis quis minim incididunt incididunt. Incididunt minim et elit ipsum labore consectetur amet tempor enim. Ad magna sit aliqua sit adipiscing do ut. Sit aliqua nostrud et elit do veniam incididunt dolore ad magna enim lorem ipsum. Sed magna eiusmod magna nostrud consectetur dolor quis dolore ut. Consectetur lorem sed sit adipiscing magna ad consectetur do sit ad elit sed lorem. Adipiscing veniam quis nostrud aliqua eiusmod magna do labore et enim eiusmod dolor. Minim minim ipsum lorem quis eiusmod do do magna minim quis ut."}},required:["subject","body","recipientEmail"]}},{relatedRequestId:t.requestId});if("accept"!==a.action)return{content:[{type:"text",text:"Email drafting cancelled by user."}],isError:!0};let s={confirmation:"Email sent! (just kidding)",...a.content};return{content:[{type:"text",text:JSON.stringify(s,null,2)}],structuredContent:s}}),e.resource("Available greetings","greeting://all_greetings",e=>({contents:[{uri:e.href,text:"Hello!"},{uri:e.href,text:"Hi!"},{uri:e.href,text:"Hey!"}]})),e.registerTool("structuredContent",{description:"Returns some structured content",inputSchema:{backwardsCompatible:a.zM().describe("Whether to include the structured content in the content blocks as well (as per MCP spec recommendation, for backwards compatibility)")},outputSchema:{message:a.Yj()}},e=>{let{backwardsCompatible:n}=e,t={message:"Your name is now Claudette."};return{content:n?[{type:"text",text:JSON.stringify(t)}]:[],structuredContent:t}}),e.registerPrompt("ask_to_greet",{description:"Generate a prompt to ask the assistant to greet someone",argsSchema:{name:a.Yj().describe("Name of the person to greet")}},e=>{let{name:n}=e;return{messages:[{role:"user",content:{type:"text",text:"Please greet: ".concat(n)}}]}}),e}p.u9.shape.params;var g=t(0x308050d8);let v="ui://mcp-antfooding/imagine-svg.html";var y=function(e){return e.MCP_APPS_IMAGINE_SVG="mcp_apps_imagine_svg",e}(y||{});function b(){let e=new g.g({name:"MCP Antfooding",version:"1.0.0"},{capabilities:{tools:{},resources:{}}});return e.setRequestHandler(p.gW,()=>({tools:[{name:"mcp_apps_imagine_svg",description:'Renders SVG diagrams and graphics inline alongside text chat messages. Call when user asks to visualize something that can be represented as SVG (diagrams, schemas, flowcharts, icons, vector illustrations, visual explanations, etc).\n\nCRITICAL: The SVG will be displayed on app in either LIGHT or DARK mode. You SHOULD use CSS variables for the colors when possible to ensure the graphic looks correct in both themes and well integrated into app design. Try to avoid hardcoded colors like #000 or #fff when possible (unless if it\'s artistic graphical elements).\n\nLAYOUT:\n- Keep background TRANSPARENT (no fill on root svg)\n- Use full 700px width, height is flexible but keep compact\n- No XML comments - only valid SVG code\n\nCONTENT:\n- Minimize text in SVG - you can add explanations in markdown AFTER this tool call\n- Focus on visual representation, no text-heavy components\n- You will always have opportunity to add text explanations in markdown after this tool call (can use color emoji in text to refer to elements on the illustration)\n\nCSS VARIABLES (values shown as light/dark):\n\nBackground colors:\n- var(--color-background-primary): Main bg (#fff / #30302e)\n- var(--color-background-secondary): Card/surface (#f5f4ed / #26261f)\n- var(--color-background-tertiary): Subtle bg (#faf9f5 / #141413)\n- var(--color-background-inverse): Inverse bg (#141413 / #faf9f5)\n- var(--color-background-ghost): Transparent\n- var(--color-background-info): Blue bg (#d6e4f6 / #253e5f)\n- var(--color-background-danger): Red bg (#f7ecec / #602a28)\n- var(--color-background-success): Green bg (#e9f1dc / #1b4614)\n- var(--color-background-warning): Yellow bg (#f6eedf / #483a0f)\n\nText colors:\n- var(--color-text-primary): Main text (#141413 / #faf9f5)\n- var(--color-text-secondary): Muted text (#3d3d3a / #c2c0b6)\n- var(--color-text-tertiary): Subtle text (#73726c / #9c9a92)\n- var(--color-text-inverse): Inverse text (#fff / #141413)\n- var(--color-text-info): Blue accent (#3266ad / #80aadd)\n- var(--color-text-danger): Red accent (#7f2c28 / #ee8884)\n- var(--color-text-success): Green accent (#265b19 / #7ab948)\n- var(--color-text-warning): Yellow accent (#5a4815 / #d1a041)\n- var(--color-text-ghost): Ghost text (#73726c80 / #9c9a9280)\n\nBorder colors:\n- var(--color-border-primary): Main border (0.4 alpha)\n- var(--color-border-secondary): Border (0.3 alpha)\n- var(--color-border-tertiary): Subtle border (0.15 alpha)\n- var(--color-border-info): Blue border (#4682d5)\n- var(--color-border-danger): Red border (#a73d39 / #cd5c58)\n- var(--color-border-success): Green border (#437426 / #599130)\n\nTypography:\n- var(--font-sans): Anthropic Sans, sans-serif\n- var(--font-mono): ui-monospace, monospace\n- var(--font-weight-normal): 400\n- var(--font-weight-medium): 500\n- var(--font-weight-semibold): 600\n- var(--font-weight-bold): 700\n- var(--font-text-sm-size): 14px\n- var(--font-text-md-size): 16px\n- var(--font-text-lg-size): 20px\n\nBorder radius:\n- var(--border-radius-xs): 4px\n- var(--border-radius-sm): 6px\n- var(--border-radius-md): 8px\n- var(--border-radius-lg): 10px\n- var(--border-radius-xl): 12px\n- var(--border-radius-full): 9999px\n\nShadows:\n- var(--shadow-hairline): 0 1px 2px rgba(0,0,0,0.05)\n- var(--shadow-sm): 0 1px 3px rgba(0,0,0,0.1)\n- var(--shadow-md): 0 4px 6px -1px rgba(0,0,0,0.1)\n- var(--shadow-lg): 0 10px 15px -3px rgba(0,0,0,0.1)\n\nEXAMPLES:\n<text fill="var(--color-text-primary)">Title</text>\n<text fill="var(--color-text-secondary)">Subtitle</text>\n<rect fill="var(--color-background-secondary)" stroke="var(--color-border-secondary)" rx="var(--border-radius-md)" />\n<circle fill="var(--color-text-info)" /> \x3c!-- blue accent --\x3e\n<path stroke="var(--color-text-tertiary)" fill="none" /> \x3c!-- muted line --\x3e',inputSchema:{type:"object",properties:{code:{type:"string",description:'Raw SVG code starting with <svg> tag. Must use CSS variables for colors (see tool description). Example: <svg viewBox="0 0 700 400" xmlns="http://www.w3.org/2000/svg">...</svg>'}},required:["code"]},annotations:{readOnlyHint:!0},_meta:{"ui/resourceUri":v}}]})),e.setRequestHandler(p.FT,e=>{let{name:n}=e.params;return"mcp_apps_imagine_svg"===n?{content:[{type:"text",text:"SVG rendered and shown to the user. Please do not duplicate the shown content in text because it's already visually represented."}]}:{content:[{type:"text",text:"Unknown tool: ".concat(n)}],isError:!0}}),e.setRequestHandler(p.OI,()=>({resources:[{uri:v,name:"Imagine SVG Widget",description:"Renders SVG graphics progressively as they stream for the mcp_apps_imagine_svg tool",mimeType:"text/html;profile=mcp-app"}]})),e.setRequestHandler(p.R6,e=>{let{uri:n}=e.params;if(n===v)return{contents:[{uri:v,mimeType:"text/html;profile=mcp-app",text:'<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8" />\n  <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n  <title>Imagine SVG Widget</title>\n  <style>\n    @font-face {\n      font-family: "Anthropic Sans";\n      src: url("https://assets.anthropic.com/m/615ef9f8465bfb6f/original/StyreneBLC-Regular.otf") format("opentype");\n      font-weight: 400;\n      font-style: normal;\n      font-display: swap;\n    }\n    @font-face {\n      font-family: "Anthropic Sans";\n      src: url("https://assets.anthropic.com/m/7a2a966e3e0ac949/original/StyreneBLC-RegularItalic.otf") format("opentype");\n      font-weight: 400;\n      font-style: italic;\n      font-display: swap;\n    }\n    @font-face {\n      font-family: "Anthropic Sans";\n      src: url("https://assets.anthropic.com/m/78f19c4a1fe4b2b6/original/StyreneBLC-Medium.otf") format("opentype");\n      font-weight: 500;\n      font-style: normal;\n      font-display: swap;\n    }\n    @font-face {\n      font-family: "Anthropic Sans";\n      src: url("https://assets.anthropic.com/m/6ce2faaeff594850/original/StyreneBLC-MediumItalic.otf") format("opentype");\n      font-weight: 500;\n      font-style: italic;\n      font-display: swap;\n    }\n    :root {\n      color-scheme: light dark;\n    }\n    * { box-sizing: border-box; margin: 0; padding: 0; }\n    body {\n      font-family: system-ui, -apple-system, sans-serif;\n      background: transparent;\n    }\n    #container {\n      width: 100%;\n      min-height: 100px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n    #container svg {\n      max-width: 100%;\n      height: auto;\n    }\n    .loading {\n      color: #888;\n      font-size: 0.875rem;\n    }\n  </style>\n</head>\n<body>\n  <div id="container">\n    <span class="loading">Waiting for SVG...</span>\n  </div>\n\n  <script type="module">\n'.concat('\n    const app = (() => {\n      let nextId = 1;\n\n      return {\n        sendRequest({ method, params }) {\n          const id = nextId++;\n          window.parent.postMessage({ jsonrpc: "2.0", id, method, params }, "*");\n          return new Promise((resolve, reject) => {\n            window.addEventListener("message", function listener(event) {\n              const data = event.data;\n              if (event.data?.id === id) {\n                window.removeEventListener("message", listener);\n                if (event.data?.result) {\n                  resolve(event.data.result);\n                } else if (event.data?.error) {\n                  reject(new Error(event.data.error));\n                }\n              }\n              // Ignore non-matching messages (notifications, other requests)\n            });\n          });\n        },\n        sendNotification({ method, params }) {\n          window.parent.postMessage({ jsonrpc: "2.0", method, params }, "*");\n        },\n        onNotification(method, handler) {\n          window.addEventListener("message", function listener(event) {\n            if (event.data?.method === method) {\n              handler(event.data.params);\n            }\n          });\n        },\n        setupAutoResize() {\n          new ResizeObserver(() => {\n            const { body, documentElement: html } = document;\n            const htmlStyle = getComputedStyle(html);\n\n            // getBoundingClientRect returns fractional values (unlike scrollHeight)\n            const rect = body.getBoundingClientRect();\n\n            const width = Math.ceil(rect.width);\n            const height = Math.ceil(\n              rect.height +\n              (parseFloat(htmlStyle.borderTop) || 0) +\n              (parseFloat(htmlStyle.borderBottom) || 0)\n            );\n\n            this.sendNotification({\n              method: "ui/notifications/size-changed",\n              params: { width, height }\n            });\n          }).observe(document.body);\n        },\n      };\n    })();\n','\n\n    const IMPLEMENTATION = { name: "Imagine SVG Widget", version: "1.0.0" };\n\n    // Lazy-loaded CDN dependencies for streaming (loaded on first partial)\n    let parserModules = null;\n\n    // State\n    let streamingParser = null;\n    let prevCode = \'\';\n    const container = document.getElementById(\'container\');\n\n    // Render complete SVG (final tool-input) - just set innerHTML\n    function renderSvg(code) {\n      if (!code) {\n        container.innerHTML = \'<span class="loading">Waiting for SVG...</span>\';\n        return;\n      }\n      container.innerHTML = code;\n    }\n\n    // Render partial/streaming SVG - uses htmlparser2 to auto-close incomplete tags\n    async function renderPartialSvg(code) {\n      if (!code) {\n        container.innerHTML = \'<span class="loading">Waiting for SVG...</span>\';\n        return;\n      }\n\n      // Lazy-load CDN modules on first use\n      if (!parserModules) {\n        try {\n          const [htmlparser2, domhandler, domSerializer] = await Promise.all([\n            import(\'https://esm.sh/htmlparser2@9.1.0\'),\n            import(\'https://esm.sh/domhandler@5.0.3\'),\n            import(\'https://esm.sh/dom-serializer@2.0.0\')\n          ]);\n          parserModules = { Parser: htmlparser2.Parser, DomHandler: domhandler.DomHandler, render: domSerializer.default };\n        } catch (err) {\n          console.warn("[ImagineSvgWidget] CDN failed, falling back to innerHTML:", err);\n          container.innerHTML = code;\n          return;\n        }\n      }\n\n      // Reset parser if code restarted (shorter than before means new stream)\n      if (code.length < prevCode.length || !streamingParser) {\n        const handler = new parserModules.DomHandler();\n        streamingParser = {\n          parser: new parserModules.Parser(handler, {\n            decodeEntities: false,\n            lowerCaseAttributeNames: false,\n            lowerCaseTags: false,\n            recognizeSelfClosing: true\n          }),\n          handler,\n          write(chunk) { this.parser.write(chunk); },\n          serialize() { return parserModules.render(this.handler.root.children, { encodeEntities: false }); }\n        };\n        prevCode = \'\';\n      }\n\n      // Parse new chunk only\n      const newChunk = code.substring(prevCode.length);\n      if (newChunk) {\n        streamingParser.write(newChunk);\n        prevCode = code;\n      }\n\n      // Serialize (auto-closes tags) and render\n      const completedSvg = streamingParser.serialize();\n      if (completedSvg) {\n        container.innerHTML = completedSvg;\n      }\n    }\n\n    // MCP App connection\n    let nextRequestId = 1;\n\n    async function connectToHost() {\n      try {\n        // Listen for messages from parent\n        window.addEventListener("message", (event) => {\n          try {\n            const data = event.data;\n            if (data && data.jsonrpc === "2.0") {\n              // Handle initialize response - send initialized notification\n              if (data.id === 1 && data.result) {\n                // TODO: Remove debug logging\n                console.warn("\uD83C\uDFA8 [ImagineSvgWidget] FULL INIT RESPONSE:", JSON.stringify(data.result, null, 2));\n\n                // Inject CSS variables from host context\n                if (data.result.hostContext?.styles?.variables) {\n                  const variables = data.result.hostContext.styles.variables;\n                  const style = document.createElement(\'style\');\n                  style.id = \'mcp-host-variables\';\n                  style.textContent = \':root {\\n\' +\n                    Object.entries(variables).map(([key, value]) => \'  \' + key + \': \' + value + \';\').join(\'\\n\') +\n                    \'\\n}\';\n                  document.head.appendChild(style);\n                }\n\n                const initializedNotification = {\n                  jsonrpc: "2.0",\n                  method: "ui/notifications/initialized",\n                  params: {}\n                };\n                window.parent.postMessage(initializedNotification, "*");\n              }\n            }\n          } catch (err) {\n            console.error("[ImagineSvgWidget] Error handling message:", err);\n          }\n        });\n\n        // Register notification handlers\n        app.onNotification("ui/notifications/tool-input-partial", (params) => {\n          const code = params?.arguments?.code;\n          if (code) {\n            renderPartialSvg(code);  // Uses streaming parser for incomplete SVG\n          }\n        });\n\n        app.onNotification("ui/notifications/tool-input", (params) => {\n          const code = params?.arguments?.code;\n          if (code) {\n            renderSvg(code);  // Uses native DOMParser for complete SVG\n          }\n        });\n\n        // Send initialize request\n        const initRequest = {\n          jsonrpc: "2.0",\n          id: nextRequestId++,\n          method: "ui/initialize",\n          params: {\n            protocolVersion: "2025-11-21",\n            appInfo: IMPLEMENTATION,\n            appCapabilities: {}\n          }\n        };\n        window.parent.postMessage(initRequest, "*");\n        app.setupAutoResize();\n      } catch (err) {\n        console.error("[ImagineSvgWidget] Failed to connect:", err);\n      }\n    }\n\n    // Connect when page loads\n    connectToHost();\n  <\/script>\n</body>\n</html>'),_meta:{ui:{csp:{resourceDomains:["https://assets.anthropic.com","https://esm.sh"]}}}}]};throw Error("Unknown resource: ".concat(n))}),e}let w="ui/resourceUri",x="ui://mcp-apps-example/hello-world.html",C="ui://mcp-apps-example/counter.html";var _=function(e){return e.MCP_APPS_HELLO="mcp_apps_hello",e.MCP_APPS_COUNTER="mcp_apps_counter",e}(_||{});let k='\n    const app = (() => {\n      let nextId = 1;\n\n      return {\n        sendRequest({ method, params }) {\n          const id = nextId++;\n          window.parent.postMessage({ jsonrpc: "2.0", id, method, params }, "*");\n          return new Promise((resolve, reject) => {\n            window.addEventListener("message", function listener(event) {\n              const data = event.data;\n              if (event.data?.id === id) {\n                window.removeEventListener("message", listener);\n                if (event.data?.result) {\n                  resolve(event.data.result);\n                } else if (event.data?.error) {\n                  reject(new Error(event.data.error));\n                }\n              } else {\n                reject(new Error(`Unsupported message: ${JSON.stringify(data)}`));\n              }\n            });\n          });\n        },\n        sendNotification({ method, params }) {\n          window.parent.postMessage({ jsonrpc: "2.0", method, params }, "*");\n        },\n        onNotification(method, handler) {\n          window.addEventListener("message", function listener(event) {\n            if (event.data?.method === method) {\n              handler(event.data.params);\n            }\n          });\n        },\n        setupAutoResize() {\n          new ResizeObserver(() => {\n            const { body, documentElement: html } = document;\n            const htmlStyle = getComputedStyle(html);\n\n            // getBoundingClientRect returns fractional values (unlike scrollHeight)\n            const rect = body.getBoundingClientRect();\n\n            const width = Math.ceil(rect.width);\n            const height = Math.ceil(\n              rect.height +\n              (parseFloat(htmlStyle.borderTop) || 0) +\n              (parseFloat(htmlStyle.borderBottom) || 0)\n            );\n\n            this.sendNotification({\n              method: "ui/notifications/size-changed",\n              params: { width, height }\n            });\n          }).observe(document.body);\n        },\n      };\n    })();\n';function S(){let e=new g.g({name:"MCP Apps Example",version:"1.0.0"},{capabilities:{tools:{},resources:{}}});return e.setRequestHandler(p.gW,()=>({tools:[{name:"mcp_apps_hello",description:"Demonstrates MCP Apps - returns an interactive UI that greets the user",inputSchema:{type:"object",properties:{name:{type:"string",description:"Name to greet"}}},_meta:{[w]:x}},{name:"mcp_apps_counter",description:"Demonstrates MCP Apps with an interactive counter UI. The user can increment/decrement the counter.",inputSchema:{type:"object",properties:{initialValue:{type:"number",description:"Initial counter value",default:0}}},_meta:{[w]:C}}]})),e.setRequestHandler(p.FT,e=>{let{name:n,arguments:t}=e.params;if("mcp_apps_hello"===n){let e=null==t?void 0:t.name;return{content:[{type:"text",text:"Greeting: ".concat(e?"Hello, ".concat(e,"!"):"Hello, World!",". If your client supports MCP Apps, an interactive UI should have rendered.")}]}}if("mcp_apps_counter"===n){var r;let e=null!=(r=null==t?void 0:t.initialValue)?r:0;return{content:[{type:"text",text:"Counter initialized to ".concat(e,". If your client supports MCP Apps, an interactive counter UI should have rendered.")}]}}return{content:[{type:"text",text:"Unknown tool: ".concat(n)}],isError:!0}}),e.setRequestHandler(p.OI,()=>({resources:[{uri:x,name:"Hello World MCP App",description:"Interactive greeting UI for the mcp_apps_hello tool",mimeType:"text/html;profile=mcp-app"},{uri:C,name:"Counter MCP App",description:"Interactive counter UI for the mcp_apps_counter tool",mimeType:"text/html;profile=mcp-app"}]})),e.setRequestHandler(p.R6,e=>{let{uri:n}=e.params;if(n===x)return{contents:[{uri:x,mimeType:"text/html;profile=mcp-app",text:'<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8" />\n  <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n  <title>Hello World MCP App</title>\n  <style>\n    * { box-sizing: border-box; margin: 0; padding: 0; }\n    body {\n      font-family: system-ui, -apple-system, sans-serif;\n      padding: 1rem;\n      background: transparent;\n    }\n    .container {\n      max-width: 400px;\n    }\n    h1 {\n      font-size: 1.25rem;\n      margin-bottom: 0.75rem;\n      color: #1a1a1a;\n    }\n    .greeting {\n      font-size: 1.5rem;\n      padding: 1rem;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      border-radius: 8px;\n      text-align: center;\n      margin-bottom: 1rem;\n    }\n    .input-row {\n      display: flex;\n      gap: 0.5rem;\n      margin-bottom: 1rem;\n    }\n    input {\n      flex: 1;\n      padding: 0.5rem 0.75rem;\n      border: 1px solid #ddd;\n      border-radius: 6px;\n      font-size: 0.875rem;\n    }\n    input:focus {\n      outline: none;\n      border-color: #667eea;\n    }\n    button {\n      padding: 0.5rem 1rem;\n      background: #667eea;\n      color: white;\n      border: none;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 0.875rem;\n    }\n    button:hover {\n      background: #5a67d8;\n    }\n    .info {\n      font-size: 0.75rem;\n      color: #666;\n    }\n    .tool-input {\n      margin-top: 1rem;\n      padding: 0.75rem;\n      background: #f5f5f5;\n      border-radius: 6px;\n      font-size: 0.75rem;\n    }\n    .tool-input pre {\n      white-space: pre-wrap;\n      word-break: break-all;\n    }\n  </style>\n</head>\n<body>\n  <div class="container" id="app">\n    <h1>Hello World MCP App</h1>\n    <div class="greeting" id="greeting">Hello, World!</div>\n    <div class="input-row">\n      <input type="text" id="nameInput" placeholder="Enter a name..." />\n      <button id="greetBtn">Greet</button>\n    </div>\n    <p class="info">Type a name and click Greet to update the greeting.</p>\n    <div class="tool-input" id="toolInputDisplay" style="display: none;">\n      <strong>Tool Input:</strong>\n      <pre id="toolInputContent"></pre>\n    </div>\n  </div>\n\n  <script type="module">\n'.concat(k,'\n    const IMPLEMENTATION = { name: "Hello World App", version: "1.0.0" };\n\n    // State\n    let currentName = "World";\n\n    // DOM elements\n    const greetingEl = document.getElementById("greeting");\n    const nameInput = document.getElementById("nameInput");\n    const greetBtn = document.getElementById("greetBtn");\n    const toolInputDisplay = document.getElementById("toolInputDisplay");\n    const toolInputContent = document.getElementById("toolInputContent");\n\n    // Update greeting\n    function updateGreeting(name) {\n      currentName = name || "World";\n      greetingEl.textContent = "Hello, " + currentName + "!";\n    }\n\n    // Handle button click\n    greetBtn.addEventListener("click", () => {\n      updateGreeting(nameInput.value);\n      nameInput.value = "";\n    });\n\n    // Handle enter key\n    nameInput.addEventListener("keypress", (e) => {\n      if (e.key === "Enter") {\n        updateGreeting(nameInput.value);\n        nameInput.value = "";\n      }\n    });\n\n    // MCP App connection\n    let nextRequestId = 1;\n\n    async function connectToHost() {\n      try {\n        // Listen for messages from parent\n        window.addEventListener("message", (event) => {\n          try {\n            const data = event.data;\n            if (data && data.jsonrpc === "2.0") {\n              // Handle initialize response - send initialized notification to complete handshake\n              if (data.id === 1 && data.result) {\n                const initializedNotification = {\n                  jsonrpc: "2.0",\n                  method: "ui/notifications/initialized",\n                  params: {}\n                };\n                window.parent.postMessage(initializedNotification, "*");\n              }\n            }\n          } catch (err) {\n            console.error("[HelloWorldApp] Error handling message:", err);\n          }\n        });\n\n        // Register notification handlers\n        app.onNotification("ui/notifications/tool-input", (params) => {\n          const args = params?.arguments || {};\n          toolInputDisplay.style.display = "block";\n          toolInputContent.textContent = JSON.stringify(args, null, 2);\n          if (args.name) {\n            updateGreeting(args.name);\n          }\n        });\n\n        app.onNotification("ui/notifications/tool-result", (params) => {\n          console.log("[HelloWorldApp] Tool result:", params);\n        });\n\n        app.onNotification("ui/notifications/host-context-changed", (params) => {\n          console.log("[HelloWorldApp] Host context changed:", params);\n        });\n\n        // Send initialize request\n        const initRequest = {\n          jsonrpc: "2.0",\n          id: nextRequestId++,\n          method: "ui/initialize",\n          params: {\n            protocolVersion: "2025-11-21",\n            appInfo: IMPLEMENTATION,\n            appCapabilities: {}\n          }\n        };\n        window.parent.postMessage(initRequest, "*");\n        app.setupAutoResize();\n      } catch (err) {\n        console.error("[HelloWorldApp] Failed to connect:", err);\n      }\n    }\n\n    // Connect when page loads\n    connectToHost();\n  <\/script>\n</body>\n</html>')}]};if(n===C)return{contents:[{uri:C,mimeType:"text/html;profile=mcp-app",text:'<!DOCTYPE html>\n<html lang="en">\n<head>\n  <meta charset="UTF-8" />\n  <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n  <title>Counter MCP App</title>\n  <style>\n    * { box-sizing: border-box; margin: 0; padding: 0; }\n    body {\n      font-family: system-ui, -apple-system, sans-serif;\n      padding: 1rem;\n      background: transparent;\n    }\n    .container {\n      max-width: 300px;\n      text-align: center;\n    }\n    h1 {\n      font-size: 1.25rem;\n      margin-bottom: 1rem;\n      color: #1a1a1a;\n    }\n    .counter-display {\n      font-size: 3rem;\n      font-weight: bold;\n      padding: 1.5rem;\n      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);\n      color: white;\n      border-radius: 12px;\n      margin-bottom: 1rem;\n      min-width: 150px;\n      display: inline-block;\n    }\n    .buttons {\n      display: flex;\n      gap: 0.5rem;\n      justify-content: center;\n      margin-bottom: 1rem;\n    }\n    button {\n      width: 50px;\n      height: 50px;\n      font-size: 1.5rem;\n      border: none;\n      border-radius: 50%;\n      cursor: pointer;\n      transition: transform 0.1s;\n    }\n    button:hover {\n      transform: scale(1.1);\n    }\n    button:active {\n      transform: scale(0.95);\n    }\n    .decrement {\n      background: #ff6b6b;\n      color: white;\n    }\n    .increment {\n      background: #4ecdc4;\n      color: white;\n    }\n    .reset {\n      background: #95a5a6;\n      color: white;\n      font-size: 0.75rem;\n      width: 60px;\n      height: 30px;\n      border-radius: 15px;\n    }\n    .info {\n      font-size: 0.75rem;\n      color: #666;\n      margin-top: 0.5rem;\n    }\n  </style>\n</head>\n<body>\n  <div class="container">\n    <h1>Counter</h1>\n    <div class="counter-display" id="counter">0</div>\n    <div class="buttons">\n      <button class="decrement" id="decrementBtn">-</button>\n      <button class="increment" id="incrementBtn">+</button>\n    </div>\n    <button class="reset" id="resetBtn">Reset</button>\n    <p class="info">Click the buttons to change the counter value.</p>\n  </div>\n\n  <script type="module">\n'.concat(k,'\n    const IMPLEMENTATION = { name: "Counter App", version: "1.0.0" };\n\n    // State\n    let count = 0;\n    let initialValue = 0;\n\n    // DOM elements\n    const counterEl = document.getElementById("counter");\n    const incrementBtn = document.getElementById("incrementBtn");\n    const decrementBtn = document.getElementById("decrementBtn");\n    const resetBtn = document.getElementById("resetBtn");\n\n    // Update display\n    function updateDisplay() {\n      counterEl.textContent = count;\n      // Add color animation based on value\n      if (count > 0) {\n        counterEl.style.background = "linear-gradient(135deg, #11998e 0%, #38ef7d 100%)";\n      } else if (count < 0) {\n        counterEl.style.background = "linear-gradient(135deg, #ff6b6b 0%, #ee5a5a 100%)";\n      } else {\n        counterEl.style.background = "linear-gradient(135deg, #667eea 0%, #764ba2 100%)";\n      }\n    }\n\n    // Event listeners\n    incrementBtn.addEventListener("click", () => {\n      count++;\n      updateDisplay();\n    });\n\n    decrementBtn.addEventListener("click", () => {\n      count--;\n      updateDisplay();\n    });\n\n    resetBtn.addEventListener("click", () => {\n      count = initialValue;\n      updateDisplay();\n    });\n\n    // MCP App connection\n    let nextRequestId = 1;\n\n    async function connectToHost() {\n      try {\n        // Listen for messages from parent\n        window.addEventListener("message", (event) => {\n          try {\n            const data = event.data;\n            if (data && data.jsonrpc === "2.0") {\n              // Handle initialize response - send initialized notification to complete handshake\n              if (data.id === 1 && data.result) {\n                const initializedNotification = {\n                  jsonrpc: "2.0",\n                  method: "ui/notifications/initialized",\n                  params: {}\n                };\n                window.parent.postMessage(initializedNotification, "*");\n              }\n            }\n          } catch (err) {\n            console.error("[CounterApp] Error handling message:", err);\n          }\n        });\n\n        // Register notification handlers\n        app.onNotification("ui/notifications/tool-input", (params) => {\n          const args = params?.arguments || {};\n          if (typeof args.initialValue === "number") {\n            initialValue = args.initialValue;\n            count = initialValue;\n            updateDisplay();\n          }\n        });\n\n        app.onNotification("ui/notifications/tool-result", (params) => {\n          console.log("[CounterApp] Tool result:", params);\n        });\n\n        app.onNotification("ui/notifications/host-context-changed", (params) => {\n          console.log("[CounterApp] Host context changed:", params);\n        });\n\n        // Send initialize request\n        const initRequest = {\n          jsonrpc: "2.0",\n          id: nextRequestId++,\n          method: "ui/initialize",\n          params: {\n            protocolVersion: "2025-11-21",\n            appInfo: IMPLEMENTATION,\n            appCapabilities: {}\n          }\n        };\n        window.parent.postMessage(initRequest, "*");\n        app.setupAutoResize();\n      } catch (err) {\n        console.error("[CounterApp] Failed to connect:", err);\n      }\n    }\n\n    // Initialize\n    updateDisplay();\n    connectToHost();\n  <\/script>\n</body>\n</html>')}]};throw Error("Unknown resource: ".concat(n))}),e}var E=t(0x18393fe29),R=t(0xac309a83),M=t(0x85e0fa34),I=t(0x134b9be24),T=t(0x17509cc64),N=t(0x62983db6);function P(){let e={};return(0,N.F)()&&(e.elicitation={}),(0,T.So)()&&(e.extensions={"io.modelcontextprotocol/ui":{mimeTypes:["text/html;profile=mcp-app"]}}),new I.K({name:"claude-ai",version:"0.1.0"},{capabilities:e})}async function q(e){let n=P();return await n.connect(e),n}var A=t(0xc6857cab);function L(){return(0,E.yz)()&&!A.env.DONT_USE_EXAMPLE_MCP}let z=(e,n)=>{let t=(0,R.fS)("claude_ai_unicode_sanitize_mcp_data");(0,m.useEffect)(()=>{!async function(){if(L()){let r=n(),[i,o]=M.W.createLinkedPair();(async()=>{await r.connect(o)})(),await q(i).then(n=>{(0,h.jh)(e,n),(0,h.fR)(e,n,t),(0,h.BG)(e,n),(0,h.zC)(e,n)})}}()},[t,e,n])},H=(e,n,t)=>{let r=(0,R.fS)(t),i=(0,R.fS)("claude_ai_unicode_sanitize_mcp_data"),o=r||L();(0,m.useEffect)(()=>{!async function(){if(o){let t=n(),[r,o]=M.W.createLinkedPair();(async()=>{await t.connect(o)})(),await q(r).then(n=>{(0,h.jh)(e,n),(0,h.fR)(e,n,i),(0,h.BG)(e,n),(0,h.zC)(e,n)})}}()},[o,i,e,n])};t(0x21e26ba67);var B=t(0x2252bfeb8),O=t(0x9845e38c);function j(e){let n=(0,m.useRef)(e);return(0,m.useEffect)(()=>{n.current=e},[e]),(0,m.useCallback)(function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return n.current(...t)},[])}var D=t(0x1d0eef17),U=t(0x1dafb1ccf);class W{start(){return this._port.onmessage=e=>{var n;null==(n=this.onmessage)||n.call(this,e.data)},this._port.onmessageerror=e=>{var n;null==(n=this.onerror)||n.call(this,Error("MessagePort message error: ".concat(e.data)))},Promise.resolve()}close(){var e;return this._port.close(),null==(e=this.onclose)||e.call(this),Promise.resolve()}send(e){return this._port.postMessage(e),Promise.resolve()}constructor(e){this._port=e}}let F=()=>{let{track:e}=(0,c.st)(),n=j(e),t=(0,m.useCallback)(e=>{n({event_key:"mcp.websocket.authfailure",server_uuid:e})},[n]),r=(0,m.useCallback)((e,t)=>{n({event_key:"mcp.websocket.transport.connection.failed",server_uuid:e,used_authentication:t})},[n]),i=(0,m.useCallback)(e=>{n({event_key:"mcp.tools.listed",tool_count_on_server:e})},[n]);return{trackMcpServerAuthFailure:t,trackMcpServerConnectionFailed:r,trackMcpToolsListed:i,trackMcpResourcesListed:(0,m.useCallback)(e=>{n({event_key:"mcp.resources.listed",resource_count_on_server:e})},[n]),trackMcpPromptsListed:(0,m.useCallback)(e=>{n({event_key:"mcp.prompts.listed",prompt_count_on_server:e})},[n])}},G=Symbol();async function V(e){return q(new W(e))}var Y=t(0x4d348f95),J=t(0x1ab0d1ca1),X=t(0x253a5c787),K=t(0x1d302b010),$=t(0x8475f78a),Z=t(0x1db5af03),Q=t(0x78b33fbd);class ee extends Error{constructor(e){super(e||"Authentication error"),this.name="UnauthedError"}}class en{start(){if(this._socket)throw Error("WebSocketClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise((e,n)=>{this._socket=new WebSocket(this._url,["mcp"]),this._socket.onerror=e=>{var t;let r="error"in e?e.error:Error("WebSocket error: ".concat(JSON.stringify(e)));n(r),null==(t=this.onerror)||t.call(this,r)},this._socket.onopen=()=>{e()},this._socket.onclose=e=>{var n;null==(n=this.onclose)||n.call(this)},this._socket.onmessage=e=>{var n,t,r,i,o;let a,s;try{a=JSON.parse(e.data)}catch(e){null==(t=this.onerror)||t.call(this,e);return}let c=a;if("mcp_unauthorized"===c.error_code){null==(r=this.onAuthError)||r.call(this,new ee(c.error||"Authentication required"));return}try{s=p.OR.parse(a)}catch(e){null==(i=this.onerror)||i.call(this,e);return}let l=s;if("connected"===l.method&&l.params){null==(o=this.onConnect)||o.call(this,l.params.used_auth);return}null==(n=this.onmessage)||n.call(this,s)}})}async close(){var e;null==(e=this._socket)||e.close()}send(e){return new Promise((n,t)=>{var r;if(!this._socket)return void t(Error("Not connected"));null==(r=this._socket)||r.send(JSON.stringify(e)),n()})}constructor(e){this._url=e}}class et{async refreshClient(){return this.cachedClient=await this.getClient(),this.cachedClient}disconnectIfNoOngoingRequests(){this.cachedClient&&0===this.inflightRequestCount&&(this.cachedClient.close(),this.cachedClient=void 0)}clearTimeout(){this.debouncedDisconnectTimeout&&(clearTimeout(this.debouncedDisconnectTimeout),this.debouncedDisconnectTimeout=null)}beforeRequest(){this.inflightRequestCount++,this.clearTimeout()}afterRequest(){this.inflightRequestCount--,this.clearTimeout(),null!==this.disconnectTimeout&&(this.debouncedDisconnectTimeout=setTimeout(()=>{this.disconnectIfNoOngoingRequests()},this.disconnectTimeout))}async useClient(e){this.beforeRequest();try{return await e(await this.refreshClient())}finally{this.afterRequest()}}async initialize(){await this.refreshClient()}async connect(e){throw await Promise.resolve(),Error("Cannot call connect on a wrapped client")}async close(){var e;return null==(e=this.cachedClient)?void 0:e.close()}async registerCapabilities(e){return(await this.refreshClient()).registerCapabilities(e)}getServerCapabilities(){var e;return null==(e=this.cachedClient)?void 0:e.getServerCapabilities()}getServerVersion(){var e;return null==(e=this.cachedClient)?void 0:e.getServerVersion()}getInstructions(){var e;return null==(e=this.cachedClient)?void 0:e.getInstructions()}async ping(e){return(await this.refreshClient()).ping(e)}async complete(e,n){return this.useClient(t=>t.complete(e,n))}async setLoggingLevel(e,n){return this.useClient(t=>t.setLoggingLevel(e,n))}async getPrompt(e,n){return this.useClient(t=>t.getPrompt(e,n))}async listPrompts(e,n){return this.useClient(t=>t.listPrompts(e,n))}async listResources(e,n){return this.useClient(t=>t.listResources(e,n))}async listResourceTemplates(e,n){return this.useClient(t=>t.listResourceTemplates(e,n))}async readResource(e,n){return this.useClient(t=>t.readResource(e,n))}async subscribeResource(e,n){return this.useClient(t=>t.subscribeResource(e,n))}async unsubscribeResource(e,n){return this.useClient(t=>t.unsubscribeResource(e,n))}async callTool(e,n,t){return this.useClient(r=>r.callTool(e,n,t))}async listTools(e,n){return this.useClient(t=>t.listTools(e,n))}async sendRootsListChanged(){return this.useClient(e=>e.sendRootsListChanged())}async request(e,n,t){return this.useClient(r=>r.request(e,n,t))}async notification(e){return this.useClient(n=>n.notification(e))}async setRequestHandler(e,n){return(await this.refreshClient()).setRequestHandler(e,n)}async removeRequestHandler(e){return(await this.refreshClient()).removeRequestHandler(e)}async assertCanSetRequestHandler(e){return(await this.refreshClient()).assertCanSetRequestHandler(e)}async setNotificationHandler(e,n){return(await this.refreshClient()).setNotificationHandler(e,n)}async removeNotificationHandler(e){return(await this.refreshClient()).removeNotificationHandler(e)}async assertCapabilityForMethod(e){return(await this.refreshClient()).assertCapabilityForMethod(e)}async assertNotificationCapability(e){return(await this.refreshClient()).assertNotificationCapability(e)}async assertRequestHandlerCapability(e){return(await this.refreshClient()).assertRequestHandlerCapability(e)}get transport(){var e;return null==(e=this.cachedClient)?void 0:e.transport}constructor(e,n,t=null){this.getClient=e,this.cachedClient=n,this.disconnectTimeout=t,this.debouncedDisconnectTimeout=null,this.inflightRequestCount=0}}var er=t(0xc6857cab);async function ei(e,n,t,r){let i=function(){if((0,E.yz)()){if(er.env.NEXT_MCP_WEBSOCKET_PROXY)return er.env.NEXT_MCP_WEBSOCKET_PROXY;let e=er.env.NEXT_PUBLIC_MCP_WEBSOCKET_BACKEND||"http://localhost:8000";if(null==e?void 0:e.startsWith("http"))return e.replace("http","ws");if(null==e?void 0:e.startsWith("ws"))return e.replace("https","wss")}return""}(),o=new en("".concat(i,"/api/ws/organizations/").concat(e,"/mcp/servers/").concat(n,"/"));o.onAuthError=t,o.onConnect=r;let a=P();return await a.connect(o),a}function eo(){let e=(0,i.p)();return!function(e){let{activeOrganization:n}=(0,d.YL)(),t=null==n?void 0:n.uuid,i=F(),o=function(){let{value:e}=(0,Q.useDynamicConfig)("apps_mcp_ws_reconnect_config");return e}(),a=(0,R.fS)("claude_ai_unicode_sanitize_mcp_data"),s=(0,r.p9)(),c=(0,Z.O)(e=>e.serversNeedingWebsocketRetry),{data:l,isLoading:u}=(0,K.eB)(t),p=s?c:l,f=null==o?void 0:o.reconnect_enabled,g=(null==o?void 0:o.disconnect_enabled)&&(null==o?void 0:o.disconnect_timeout)||null,v=(0,m.useCallback)(async(e,n)=>{let t=e=>{(0,X.Cp)(e,{tags:{serverUuid:n.uuid}}),i.trackMcpServerAuthFailure(n.uuid),(0,h.Ug)(n.uuid)},r=e=>{(0,h.n3)(n.uuid,e),(async()=>{let e=await (0,h.xk)(n.uuid);if(!e){(0,X.Cp)(Error("Client is undefined after connection"),{tags:{serverUuid:n.uuid}}),(0,h.Ug)(n.uuid);return}let t=h.eZ.getState().remoteTools[n.uuid];s&&(null==t?void 0:t.length)||((0,h.MR)(n.uuid,e,a).then(e=>{i.trackMcpToolsListed(e.length)}),(0,h.k$)(n.uuid,e).then(e=>{i.trackMcpPromptsListed(e.length)}),(0,h.aF)(n.uuid,e).then(e=>{i.trackMcpResourcesListed(e.length)}))})()};try{let i=async()=>{let i=await (0,h.xk)(n.uuid);if(i&&i&&(null==i?void 0:i.transport)!==void 0)return i;let o=ei(e,n.uuid,t,r);(0,h.kc)((0,$.Ic)(n.uuid),o);let a=await o;return(0,h.kc)((0,$.Ic)(n.uuid),a),a},o=await i(),a=f?function(e,n){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new et(e,n,t)}(async()=>i(),o,g):o;(0,h.kc)(n.uuid,a)}catch(e){i.trackMcpServerConnectionFailed(n.uuid,!1),(0,X.Cp)(e,{tags:{serverUuid:n.uuid}}),(0,h.Ug)(n.uuid)}},[f,g,a,i,s]);(0,m.useEffect)(()=>{(0,h.pZ)(null!=u&&u),u||(0,h.IT)(!0)},[u]),(0,m.useEffect)(()=>{if(t&&p)for(let n of p)(0,h.s$)(n.uuid)&&((0,h.nd)(n.uuid)&&((0,h.rD)(n),(0,h.I3)(n.uuid,n.url,e)),v(t,n))},[p,v,t,s,e]),(0,m.useEffect)(()=>{if(t&&s)return h.eZ.subscribe((e,n)=>{for(let[r,i]of Object.entries(e.remoteConnectionStates)){let o=n.remoteConnectionStates[r],a=e.remoteServers[r];i.requiresWebSocket&&!(null==o?void 0:o.requiresWebSocket)&&a&&(e.remoteClients[r]||e.remoteClients[(0,$.Ic)(r)]||v(t,a))}})},[t,s,v])}(e),(0,r.oQ)(e),!function(){let{addError:e}=(0,u.Yf)(),{track:n}=(0,c.st)(),t=j(n),r=F(),i=(0,R.fS)("claude_ai_unicode_sanitize_mcp_data"),o=(0,U.Ev)(),[a,s]=(0,m.useState)(G);(0,m.useEffect)(()=>{o||(0,h.H)(U.cN)},[o]);let l=(0,m.useCallback)(n=>{(!(0,U.Ns)({name:n})||o)&&((0,h.dY)(n)||window.claudeAppBindings.connectToMcpServer(n).catch(t=>{O.v.error(O.u.MCP,"Could not connect to MCP server ".concat(n),t),e("Could not connect to MCP server ".concat(n),{error:t})}))},[e,o]);(0,m.useEffect)(()=>{let e=!1;return(async()=>{var n,r;if(!(null==(n=window.claudeAppBindings)?void 0:n.listMcpServers)||!(null==(r=window.claudeAppBindings)?void 0:r.connectToMcpServer))return;a===G&&(0,h.kU)(!0);let i=await window.claudeAppBindings.listMcpServers();if(t({event_key:"mcp.servers.listed",server_count:i.length}),(0,h.kU)(!1),!e)for(let e of i)l(e)})(),()=>{e=!0}},[l,t,a]);let d=(0,m.useCallback)(n=>{if(n.source!==window)return;let{type:a,serverName:c,uuid:l}=n.data;if("mcp-server-auto-reconnect"===a&&c){(0,h.H)(c),s(Symbol());return}if("mcp-server-connected"!==a||!c||(0,U.Ns)({name:c})&&!o)return;let[d]=n.ports;V(d).then(e=>{(0,h.jh)(c,e,l),(0,h.fR)(c,e,i).then(e=>{r.trackMcpToolsListed(e.length)}),(0,h.BG)(c,e).then(e=>{r.trackMcpPromptsListed(e.length)}),(0,h.zC)(c,e).then(e=>{r.trackMcpResourcesListed(e.length)}),t({event_key:"mcp.servers.connected",result:"success"})},n=>{(0,h.dY)(l||c)||(e("Could not attach to MCP server ".concat(c),{error:n}),t({event_key:"mcp.servers.connected",result:"failure"}))})},[e,t,i,r,o]);(0,D.M)("message",d),(0,m.useEffect)(()=>{(async()=>{try{var e;let n=await (null===B.Fd||void 0===B.Fd||null==(e=B.Fd.getInstalledExtensionsWithState)?void 0:e.call(B.Fd));null==n||n.forEach(e=>{var n;(0,h.yt)(null!=(n=e.manifest.display_name)?n:e.manifest.name,e)})}catch(e){}})()},[])}(),z("exampleServer",f),z("elicitationServer",s),H("mcpAppsExample",S,"claudeai_mcp_apps_example_server"),H("mcpAntfooding",b,"claudeai_mcp_apps_antfooding_server"),!function(){let{clients:e}=(0,h.Ak)(),{addError:n}=(0,u.Yf)(),{track:t}=(0,c.st)(),{activeOrganization:r}=(0,d.YL)(),i=(0,l.L2)("/api/organizations/".concat(null==r?void 0:r.uuid,"/dust/mcp_messages"),"POST",{enabled:!1,onError:()=>n("MCP sampling failed",{errorContext:{tags:{source:"mcp_sampling"}}})});(0,m.useEffect)(()=>{},[!1,e,i,t])}(),(0,N.R)(),!function(){let e=(0,J.A)(),n=(0,Y.useSearchParams)(),{addError:t,addSuccess:r}=(0,u.Yf)(),i=n.get("server"),o=n.get("step"),a=n.get("oauth_error"),s=n.get("oauth_error_description"),l=n.get("oauth_error_uri"),{track:d}=(0,c.st)();(0,m.useEffect)(()=>{let n=(0,h.et)(i||""),c=null==n?void 0:n.name;if(i&&o&&(c||"success"!==o)){let u=c||"the MCP server";d({event_key:"claudeai.mcp.auth.completed",result:o,uuid:i,url:null==n?void 0:n.url});let p="";switch(a&&(p=" (".concat(a),s&&(p+=": ".concat(s)),l&&(p+=", ".concat(l)),p+=")"),o){case"success":r(e.formatMessage({defaultMessage:"Connected to {serverName}.",id:"WdZqvX3coc"},{serverName:u}));break;case"start_error":t(e.formatMessage({defaultMessage:"There was an error connecting to {serverName}. Please check your server URL and make sure your server handles auth correctly.",id:"pwACugMrqk"},{serverName:u}),{messageForLogging:"There was an error connecting to {serverName}. Please check your server URL and make sure your server handles auth correctly."});break;case"end_error":t(e.formatMessage({defaultMessage:"Error connecting to {serverName}. Please confirm that you have permission to access the service, that youre using the correct credentials, and that your server handles auth correctly.",id:"x0m0Pdvskh"},{serverName:u})+p,{messageForLogging:"Error connecting to {serverName}. Please confirm that you have permission to access the service, that youre using the correct credentials, and that your server handles auth correctly."});break;default:t(e.formatMessage({defaultMessage:"An unknown error occurred connecting to {serverName}.",id:"dURdJpCNlT"},{serverName:u}),{messageForLogging:"An unknown error occurred connecting to {serverName}."})}let m=new URL(window.location.href);m.searchParams.delete("server"),m.searchParams.delete("step"),window.history.replaceState({},"",m)}},[i,o,a,s,l,e,t,r,d])}(),null}}}]);